{"filter":false,"title":"App.js","tooltip":"/App.js","undoManager":{"mark":20,"position":20,"stack":[[{"start":{"row":70,"column":28},"end":{"row":70,"column":61},"action":"remove","lines":["rallygridboardcustomfiltercontrol"],"id":2},{"start":{"row":70,"column":28},"end":{"row":70,"column":61},"action":"insert","lines":["rallygridboardinlinefiltercontrol"]}],[{"start":{"row":72,"column":20},"end":{"row":72,"column":39},"action":"remove","lines":["filterControlConfig"],"id":3},{"start":{"row":72,"column":20},"end":{"row":72,"column":44},"action":"insert","lines":["inlineFilterButtonConfig"]}],[{"start":{"row":75,"column":82},"end":{"row":75,"column":83},"action":"insert","lines":[","],"id":4}],[{"start":{"row":75,"column":83},"end":{"row":76,"column":0},"action":"insert","lines":["",""],"id":5},{"start":{"row":76,"column":0},"end":{"row":76,"column":24},"action":"insert","lines":["                        "]}],[{"start":{"row":76,"column":24},"end":{"row":85,"column":33},"action":"insert","lines":["inlineFilterPanelConfig: {","                                        quickFilterPanelConfig: {","                                            defaultFields: [","                                                'ArtifactSearch',","                                                'Owner',","                                                'ModelType'","                                            ]","                                        }","                                    }","                                }"],"id":6}],[{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"remove","lines":["    "],"id":7},{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"remove","lines":["    "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"remove","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"remove","lines":["    "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"remove","lines":["    "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"remove","lines":["    "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"remove","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"remove","lines":["    "],"id":8},{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"remove","lines":["    "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"remove","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"remove","lines":["    "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"remove","lines":["    "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"remove","lines":["    "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"remove","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"remove","lines":["    "],"id":9},{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"remove","lines":["    "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":4},"action":"remove","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"remove","lines":["    "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"remove","lines":["    "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"remove","lines":["    "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"remove","lines":["    "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":85,"column":20},"end":{"row":85,"column":21},"action":"remove","lines":["}"],"id":11}],[{"start":{"row":85,"column":16},"end":{"row":85,"column":20},"action":"remove","lines":["    "],"id":12}],[{"start":{"row":85,"column":12},"end":{"row":85,"column":16},"action":"remove","lines":["    "],"id":13}],[{"start":{"row":85,"column":8},"end":{"row":85,"column":12},"action":"remove","lines":["    "],"id":14}],[{"start":{"row":85,"column":4},"end":{"row":85,"column":8},"action":"remove","lines":["    "],"id":15}],[{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"remove","lines":["    "],"id":16}],[{"start":{"row":84,"column":25},"end":{"row":85,"column":0},"action":"remove","lines":["",""],"id":17}],[{"start":{"row":80,"column":43},"end":{"row":81,"column":47},"action":"remove","lines":[",","                                    'ModelType'"],"id":18}],[{"start":{"row":79,"column":52},"end":{"row":80,"column":43},"action":"remove","lines":[",","                                    'Owner'"],"id":19}],[{"start":{"row":0,"column":0},"end":{"row":244,"column":0},"action":"remove","lines":["var Ext = window.Ext4 || window.Ext;","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    componentCls: 'app',","    launch: function() {","        var that = this;","","        //console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    this._calculateScore(records, true);","                },","                update: function(store, rec, modified, opts) {","                    this._calculateScore([rec], false);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","        var that = this;","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardinlinefiltercontrol',","                    filterChildren: false,","                    inlineFilterButtonConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example'),","                        inlineFilterPanelConfig: {","                            quickFilterPanelConfig: {","                                defaultFields: [","                                    'ArtifactSearch'","                                ]","                            }","                        }","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = Rally.ui.grid.GridCsvExport.buildCsvExportUrl(","                                    this.down('rallygridboard').getGridOrBoard());","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    that.TimeCriticalityField, that.RROEValueField, that.UserBusinessValueField, that.JobSizeField, ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: that.WSJFScoreField,","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records,loading)  {","        var that = this;","","        Ext.Array.each(records, function(feature) {","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var jobSize   = feature.data[that.JobSizeField];","            jobSize = _.isUndefined(jobSize) || _.isNull(jobSize) ? 0 : jobSize;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            timeValue = _.isUndefined(timeValue) || _.isNull(timeValue) ? 0 : timeValue;","            ","            var OERR      = feature.data[that.RROEValueField];","            OERR = _.isUndefined(OERR) || _.isNull(OERR) ? 0 : OERR;","            ","            var userValue = feature.data[that.UserBusinessValueField];","            userValue = _.isUndefined(userValue) || _.isNull(userValue) ? 0 : userValue;","            ","            var oldScore  = feature.data[that.WSJFScoreField];","            oldScore = _.isUndefined(oldScore) || _.isNull(oldScore) ? 0 : oldScore;","            ","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            //console.log(\"jobSize: \", jobSize, \"execMandate: \", execMandate, ","            //\"timeValue: \", timeValue, \"userValue\", userValue, \"oldScore\", oldScore);","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","                //console.log(feature.data.Name,\" Calculated Score \", score, \"Old Score: \", oldScore);","                if (oldScore !== score) { // only update if score changed","                    feature.set(that.WSJFScoreField, score);","                    if( loading ) {","                        // This ensures that if this is the first time this item","                        // is loaded into the grid, the calculation will be ","                        // saved in the db.","                        feature.save();","                    }","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'","        }","    }","});",""],"id":20}],[{"start":{"row":0,"column":0},"end":{"row":244,"column":0},"action":"insert","lines":["var Ext = window.Ext4 || window.Ext;","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    componentCls: 'app',","    launch: function() {","        var that = this;","","        //console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    this._calculateScore(records, true);","                },","                update: function(store, rec, modified, opts) {","                    this._calculateScore([rec], false);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","        var that = this;","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardinlinefiltercontrol',","                    filterChildren: false,","                    inlineFilterButtonConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example'),","                        inlineFilterPanelConfig: {","                            quickFilterPanelConfig: {","                                defaultFields: [","                                    'ArtifactSearch'","                                ]","                            }","                        }","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = Rally.ui.grid.GridCsvExport.buildCsvExportUrl(","                                    this.down('rallygridboard').getGridOrBoard());","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    that.TimeCriticalityField, that.RROEValueField, that.UserBusinessValueField, that.JobSizeField, ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: that.WSJFScoreField,","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records,loading)  {","        var that = this;","","        Ext.Array.each(records, function(feature) {","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var jobSize   = feature.data[that.JobSizeField];","            jobSize = _.isUndefined(jobSize) || _.isNull(jobSize) ? 0 : jobSize;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            timeValue = _.isUndefined(timeValue) || _.isNull(timeValue) ? 0 : timeValue;","            ","            var OERR      = feature.data[that.RROEValueField];","            OERR = _.isUndefined(OERR) || _.isNull(OERR) ? 0 : OERR;","            ","            var userValue = feature.data[that.UserBusinessValueField];","            userValue = _.isUndefined(userValue) || _.isNull(userValue) ? 0 : userValue;","            ","            var oldScore  = feature.data[that.WSJFScoreField];","            oldScore = _.isUndefined(oldScore) || _.isNull(oldScore) ? 0 : oldScore;","            ","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            //console.log(\"jobSize: \", jobSize, \"execMandate: \", execMandate, ","            //\"timeValue: \", timeValue, \"userValue\", userValue, \"oldScore\", oldScore);","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","                //console.log(feature.data.Name,\" Calculated Score \", score, \"Old Score: \", oldScore);","                if (oldScore !== score) { // only update if score changed","                    feature.set(that.WSJFScoreField, score);","                    if( loading ) {","                        // This ensures that if this is the first time this item","                        // is loaded into the grid, the calculation will be ","                        // saved in the db.","                        feature.save();","                    }","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'","        }","    }","});",""],"id":21}],[{"start":{"row":0,"column":0},"end":{"row":244,"column":0},"action":"remove","lines":["var Ext = window.Ext4 || window.Ext;","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    componentCls: 'app',","    launch: function() {","        var that = this;","","        //console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    this._calculateScore(records, true);","                },","                update: function(store, rec, modified, opts) {","                    this._calculateScore([rec], false);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","        var that = this;","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardinlinefiltercontrol',","                    filterChildren: false,","                    inlineFilterButtonConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example'),","                        inlineFilterPanelConfig: {","                            quickFilterPanelConfig: {","                                defaultFields: [","                                    'ArtifactSearch'","                                ]","                            }","                        }","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = Rally.ui.grid.GridCsvExport.buildCsvExportUrl(","                                    this.down('rallygridboard').getGridOrBoard());","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    that.TimeCriticalityField, that.RROEValueField, that.UserBusinessValueField, that.JobSizeField, ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: that.WSJFScoreField,","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records,loading)  {","        var that = this;","","        Ext.Array.each(records, function(feature) {","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var jobSize   = feature.data[that.JobSizeField];","            jobSize = _.isUndefined(jobSize) || _.isNull(jobSize) ? 0 : jobSize;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            timeValue = _.isUndefined(timeValue) || _.isNull(timeValue) ? 0 : timeValue;","            ","            var OERR      = feature.data[that.RROEValueField];","            OERR = _.isUndefined(OERR) || _.isNull(OERR) ? 0 : OERR;","            ","            var userValue = feature.data[that.UserBusinessValueField];","            userValue = _.isUndefined(userValue) || _.isNull(userValue) ? 0 : userValue;","            ","            var oldScore  = feature.data[that.WSJFScoreField];","            oldScore = _.isUndefined(oldScore) || _.isNull(oldScore) ? 0 : oldScore;","            ","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            //console.log(\"jobSize: \", jobSize, \"execMandate: \", execMandate, ","            //\"timeValue: \", timeValue, \"userValue\", userValue, \"oldScore\", oldScore);","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","                //console.log(feature.data.Name,\" Calculated Score \", score, \"Old Score: \", oldScore);","                if (oldScore !== score) { // only update if score changed","                    feature.set(that.WSJFScoreField, score);","                    if( loading ) {","                        // This ensures that if this is the first time this item","                        // is loaded into the grid, the calculation will be ","                        // saved in the db.","                        feature.save();","                    }","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'","        }","    }","});",""],"id":22}],[{"start":{"row":0,"column":0},"end":{"row":249,"column":0},"action":"insert","lines":["var Ext = window.Ext4 || window.Ext;","/* global _*/","/* global Rally */","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    componentCls: 'app',","    launch: function() {","        var that = this;","","        //console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    this._calculateScore(records, true);","                },","                update: function(store, rec, modified, opts) {","                    this._calculateScore([rec], false);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","        var that = this;","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardinlinefiltercontrol',","                    filterChildren: false,","                    inlineFilterButtonConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example'),","                        inlineFilterPanelConfig: {","                            quickFilterPanelConfig: {","                                defaultFields: [","                                    'ArtifactSearch'","                                ]","                            }","                        }","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = ","                                    Rally.ui.gridboard.Export.buildCsvExportUrl(this.down('rallygridboard').getGridOrBoard());"," ","","","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    that.TimeCriticalityField, that.RROEValueField, that.UserBusinessValueField, that.JobSizeField, ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: that.WSJFScoreField,","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records,loading)  {","        var that = this;","","        Ext.Array.each(records, function(feature) {","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var jobSize   = feature.data[that.JobSizeField];","            jobSize = _.isUndefined(jobSize) || _.isNull(jobSize) ? 0 : jobSize;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            timeValue = _.isUndefined(timeValue) || _.isNull(timeValue) ? 0 : timeValue;","            ","            var OERR      = feature.data[that.RROEValueField];","            OERR = _.isUndefined(OERR) || _.isNull(OERR) ? 0 : OERR;","            ","            var userValue = feature.data[that.UserBusinessValueField];","            userValue = _.isUndefined(userValue) || _.isNull(userValue) ? 0 : userValue;","            ","            var oldScore  = feature.data[that.WSJFScoreField];","            oldScore = _.isUndefined(oldScore) || _.isNull(oldScore) ? 0 : oldScore;","            ","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            //console.log(\"jobSize: \", jobSize, \"execMandate: \", execMandate, ","            //\"timeValue: \", timeValue, \"userValue\", userValue, \"oldScore\", oldScore);","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","                //console.log(feature.data.Name,\" Calculated Score \", score, \"Old Score: \", oldScore);","                if (oldScore !== score) { // only update if score changed","                    feature.set(that.WSJFScoreField, score);","                    if( loading ) {","                        // This ensures that if this is the first time this item","                        // is loaded into the grid, the calculation will be ","                        // saved in the db.","                        feature.save();","                    }","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'","        }","    }","});",""],"id":23}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":249,"column":0},"end":{"row":249,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1478108833952,"hash":"cba34605a0a5ad76e8a5ff3aacfc0f72697c11fd"}