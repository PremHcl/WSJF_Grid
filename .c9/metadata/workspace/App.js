{"filter":false,"title":"App.js","tooltip":"/App.js","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":42,"column":30},"end":{"row":42,"column":31},"action":"insert","lines":["a"],"id":9042}],[{"start":{"row":42,"column":31},"end":{"row":42,"column":32},"action":"insert","lines":["m"],"id":9043}],[{"start":{"row":42,"column":32},"end":{"row":42,"column":33},"action":"insert","lines":["e"],"id":9044}],[{"start":{"row":42,"column":33},"end":{"row":42,"column":34},"action":"insert","lines":["s"],"id":9045}],[{"start":{"row":42,"column":33},"end":{"row":42,"column":34},"action":"remove","lines":["s"],"id":9046}],[{"start":{"row":42,"column":32},"end":{"row":42,"column":33},"action":"remove","lines":["e"],"id":9047}],[{"start":{"row":42,"column":31},"end":{"row":42,"column":32},"action":"remove","lines":["m"],"id":9048}],[{"start":{"row":42,"column":30},"end":{"row":42,"column":31},"action":"remove","lines":["a"],"id":9049}],[{"start":{"row":42,"column":29},"end":{"row":42,"column":30},"action":"remove","lines":["N"],"id":9050}],[{"start":{"row":63,"column":17},"end":{"row":63,"column":18},"action":"insert","lines":["N"],"id":9051}],[{"start":{"row":63,"column":18},"end":{"row":63,"column":19},"action":"insert","lines":["a"],"id":9052}],[{"start":{"row":63,"column":19},"end":{"row":63,"column":20},"action":"insert","lines":["m"],"id":9053}],[{"start":{"row":63,"column":20},"end":{"row":63,"column":21},"action":"insert","lines":["e"],"id":9054}],[{"start":{"row":63,"column":21},"end":{"row":63,"column":22},"action":"insert","lines":["s"],"id":9055}],[{"start":{"row":71,"column":25},"end":{"row":71,"column":26},"action":"insert","lines":["N"],"id":9056}],[{"start":{"row":71,"column":26},"end":{"row":71,"column":27},"action":"insert","lines":["a"],"id":9057}],[{"start":{"row":71,"column":27},"end":{"row":71,"column":28},"action":"insert","lines":["m"],"id":9058}],[{"start":{"row":71,"column":28},"end":{"row":71,"column":29},"action":"insert","lines":["e"],"id":9059}],[{"start":{"row":71,"column":29},"end":{"row":71,"column":30},"action":"insert","lines":["s"],"id":9060}],[{"start":{"row":37,"column":12},"end":{"row":51,"column":15},"action":"remove","lines":["Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),","                success: function(model){","                    console.log(\"Model for store: \", model);","                    Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: false","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    });","                },","                scope: this","            });"],"id":9061},{"start":{"row":37,"column":12},"end":{"row":44,"column":15},"action":"insert","lines":["Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                model: ['PortfolioItem/Feature'],","                autoLoad: true,","                enableHierarchy: false","            }).then({","                success: this._onStoreBuilt,","                scope: this","            });"]}],[{"start":{"row":38,"column":23},"end":{"row":38,"column":48},"action":"remove","lines":["['PortfolioItem/Feature']"],"id":9062},{"start":{"row":38,"column":23},"end":{"row":38,"column":51},"action":"insert","lines":["selectedType.get('TypePath')"]}],[{"start":{"row":37,"column":12},"end":{"row":44,"column":15},"action":"remove","lines":["Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                model: selectedType.get('TypePath'),","                autoLoad: true,","                enableHierarchy: false","            }).then({","                success: this._onStoreBuilt,","                scope: this","            });"],"id":9063},{"start":{"row":37,"column":12},"end":{"row":44,"column":15},"action":"insert","lines":["Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                model: ['PortfolioItem/Feature'],","                autoLoad: true,","                enableHierarchy: false","            }).then({","                success: this._onStoreBuilt,","                scope: this","            });"]}],[{"start":{"row":33,"column":33},"end":{"row":33,"column":34},"action":"remove","lines":["\""],"id":9064}],[{"start":{"row":33,"column":33},"end":{"row":33,"column":34},"action":"insert","lines":[":"],"id":9065}],[{"start":{"row":33,"column":34},"end":{"row":33,"column":35},"action":"insert","lines":[" "],"id":9066}],[{"start":{"row":33,"column":35},"end":{"row":33,"column":36},"action":"insert","lines":["\""],"id":9067}],[{"start":{"row":33,"column":36},"end":{"row":33,"column":37},"action":"insert","lines":[" "],"id":9068}],[{"start":{"row":33,"column":37},"end":{"row":33,"column":38},"action":"insert","lines":["t"],"id":9069}],[{"start":{"row":33,"column":38},"end":{"row":33,"column":39},"action":"insert","lines":["h"],"id":9070}],[{"start":{"row":33,"column":39},"end":{"row":33,"column":40},"action":"insert","lines":["i"],"id":9071}],[{"start":{"row":33,"column":40},"end":{"row":33,"column":41},"action":"insert","lines":["s"],"id":9072}],[{"start":{"row":33,"column":41},"end":{"row":33,"column":42},"action":"insert","lines":["."],"id":9073}],[{"start":{"row":33,"column":42},"end":{"row":33,"column":43},"action":"insert","lines":["_"],"id":9074}],[{"start":{"row":33,"column":43},"end":{"row":33,"column":44},"action":"insert","lines":["p"],"id":9076}],[{"start":{"row":33,"column":44},"end":{"row":33,"column":45},"action":"insert","lines":["i"],"id":9077}],[{"start":{"row":33,"column":42},"end":{"row":33,"column":45},"action":"remove","lines":["_pi"],"id":9078},{"start":{"row":33,"column":42},"end":{"row":33,"column":53},"action":"insert","lines":["_piCombobox"]}],[{"start":{"row":33,"column":36},"end":{"row":33,"column":37},"action":"insert","lines":[","],"id":9079}],[{"start":{"row":6,"column":14},"end":{"row":60,"column":14},"action":"insert","lines":["boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        this._"],"id":9080,"ignore":true},{"start":{"row":69,"column":0},"end":{"row":69,"column":55},"action":"insert","lines":["        this._boxcontainer.add(this._piCombobox); //new"]},{"start":{"row":84,"column":4},"end":{"row":88,"column":0},"action":"remove","lines":["}, //end launch","    ","    _onPICombobox: function() {","        console.log(\"onPICombobox: \", this._piCombobox);",""]},{"start":{"row":84,"column":4},"end":{"row":91,"column":3},"action":"insert","lines":["    this._boxcontainer.add(this._checkbox);","        this.add(this._boxcontainer);","    },","","    _onPICombobox: function() {","        if( this._piCombobox ) {","            var selectedType = this._piCombobox.getRecord();","   "]},{"start":{"row":91,"column":11},"end":{"row":91,"column":12},"action":"insert","lines":[" "]},{"start":{"row":91,"column":14},"end":{"row":91,"column":15},"action":"remove","lines":["("]},{"start":{"row":91,"column":15},"end":{"row":91,"column":16},"action":"insert","lines":["("]},{"start":{"row":91,"column":32},"end":{"row":93,"column":27},"action":"remove","lines":[" ) {","            var selectedType = this._piCombobox.getRecord();","            console.log(\"pi"]},{"start":{"row":91,"column":32},"end":{"row":100,"column":15},"action":"insert","lines":[".getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }","        ","            Rally.data.ModelFactory.getModel({","               "]},{"start":{"row":100,"column":22},"end":{"row":100,"column":24},"action":"remove","lines":["\","]},{"start":{"row":100,"column":50},"end":{"row":101,"column":0},"action":"remove","lines":[" );",""]},{"start":{"row":100,"column":50},"end":{"row":103,"column":12},"action":"insert","lines":[",","                success: function(model){","                    if (this._myGrid === undefined) {","            "]},{"start":{"row":103,"column":35},"end":{"row":103,"column":36},"action":"remove","lines":["'"]},{"start":{"row":103,"column":35},"end":{"row":103,"column":36},"action":"insert","lines":["\""]},{"start":{"row":103,"column":47},"end":{"row":103,"column":48},"action":"remove","lines":["w"]},{"start":{"row":103,"column":47},"end":{"row":103,"column":48},"action":"insert","lines":["W"]},{"start":{"row":103,"column":52},"end":{"row":105,"column":0},"action":"remove","lines":[".TreeStoreBuilder').build({","                model: ['PortfolioItem/Feature'],",""]},{"start":{"row":103,"column":52},"end":{"row":105,"column":12},"action":"insert","lines":["DataStore\", {","                            model: model,","            "]},{"start":{"row":106,"column":16},"end":{"row":106,"column":38},"action":"remove","lines":["enableHierarchy: false"]},{"start":{"row":106,"column":16},"end":{"row":106,"column":62},"action":"insert","lines":["            filters: this._getReleaseFilter(),"]},{"start":{"row":107,"column":12},"end":{"row":108,"column":0},"action":"remove","lines":["}).then({",""]},{"start":{"row":107,"column":28},"end":{"row":108,"column":0},"action":"remove","lines":["success: this._onStoreBuilt,",""]},{"start":{"row":107,"column":28},"end":{"row":108,"column":11},"action":"insert","lines":["remoteSort: false,","           "]},{"start":{"row":108,"column":27},"end":{"row":108,"column":38},"action":"remove","lines":["scope: this"]},{"start":{"row":108,"column":27},"end":{"row":108,"column":40},"action":"insert","lines":[" listeners: {"]},{"start":{"row":109,"column":12},"end":{"row":110,"column":0},"action":"remove","lines":["});",""]},{"start":{"row":109,"column":20},"end":{"row":110,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":109,"column":24},"end":{"row":110,"column":0},"action":"remove","lines":["},",""]},{"start":{"row":109,"column":28},"end":{"row":110,"column":0},"action":"remove","lines":["",""]},{"start":{"row":109,"column":32},"end":{"row":109,"column":45},"action":"remove","lines":["_onStoreBuilt"]},{"start":{"row":109,"column":32},"end":{"row":109,"column":36},"action":"insert","lines":["load"]},{"start":{"row":109,"column":52},"end":{"row":119,"column":27},"action":"remove","lines":[") {","        console.log(\"store: \", store);","        var model = this._piCombobox.getRecord().get('TypePath');","        console.log(\"model: \", model);","        var context = this.getContext();","        this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: model,","            toggleState: 'grid',","            stateful: false"]},{"start":{"row":109,"column":52},"end":{"row":119,"column":83},"action":"insert","lines":[", records, success) {","                                    this._calculateScore(records);","                                    this._updateGrid(store);","                                },","                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },","                                scope: this","                            },","                            fetch: [\"Name\", \"FormattedID\", \"Release\", ","                                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\""]},{"start":{"row":120,"column":12},"end":{"row":121,"column":0},"action":"remove","lines":["plugins: [",""]},{"start":{"row":120,"column":12},"end":{"row":120,"column":16},"action":"insert","lines":["    "]},{"start":{"row":120,"column":32},"end":{"row":121,"column":0},"action":"remove","lines":["'rallygridboardaddnew',",""]},{"start":{"row":120,"column":32},"end":{"row":121,"column":5},"action":"insert","lines":["\"WSJFScore\", \"JobSize\"]","     "]},{"start":{"row":121,"column":21},"end":{"row":121,"column":22},"action":"remove","lines":["{"]},{"start":{"row":121,"column":21},"end":{"row":121,"column":27},"action":"insert","lines":["   });"]},{"start":{"row":122,"column":20},"end":{"row":124,"column":32},"action":"remove","lines":["ptype: 'rallygridboardcustomfiltercontrol',","                    headerPosition: 'left',","                    modelNames: "]},{"start":{"row":122,"column":20},"end":{"row":124,"column":58},"action":"insert","lines":["}","                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel("]},{"start":{"row":124,"column":63},"end":{"row":124,"column":64},"action":"remove","lines":[","]},{"start":{"row":124,"column":63},"end":{"row":124,"column":65},"action":"insert","lines":[");"]},{"start":{"row":125,"column":20},"end":{"row":125,"column":35},"action":"remove","lines":["stateful: true,"]},{"start":{"row":125,"column":20},"end":{"row":125,"column":24},"action":"insert","lines":["    "]},{"start":{"row":126,"column":20},"end":{"row":126,"column":72},"action":"remove","lines":["stateId: context.getScopedStateId('columns-example')"]},{"start":{"row":126,"column":20},"end":{"row":126,"column":79},"action":"insert","lines":["    // clear and re-apply filter since reconfiguring model "]},{"start":{"row":127,"column":16},"end":{"row":128,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":127,"column":24},"end":{"row":129,"column":0},"action":"remove","lines":["    ],","            gridConfig: {",""]},{"start":{"row":127,"column":24},"end":{"row":128,"column":9},"action":"insert","lines":["// doesn't do this","         "]},{"start":{"row":128,"column":24},"end":{"row":128,"column":27},"action":"insert","lines":["var"]},{"start":{"row":128,"column":33},"end":{"row":128,"column":36},"action":"remove","lines":[": s"]},{"start":{"row":128,"column":33},"end":{"row":128,"column":53},"action":"insert","lines":[" = this._myGrid.getS"]},{"start":{"row":128,"column":57},"end":{"row":128,"column":58},"action":"remove","lines":[","]},{"start":{"row":128,"column":57},"end":{"row":128,"column":60},"action":"insert","lines":["();"]},{"start":{"row":129,"column":16},"end":{"row":131,"column":45},"action":"remove","lines":["columnCfgs: [","                    {","                        text: \"Portfolio ID\","]},{"start":{"row":129,"column":16},"end":{"row":130,"column":66},"action":"insert","lines":["         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();"]},{"start":{"row":131,"column":20},"end":{"row":132,"column":0},"action":"insert","lines":["",""]},{"start":{"row":132,"column":4},"end":{"row":133,"column":32},"action":"remove","lines":["dataIndex: \"FormattedID\",","                        flex: 1,"]},{"start":{"row":132,"column":4},"end":{"row":132,"column":65},"action":"insert","lines":["                        store.clearFilter(filter.length > 0);"]},{"start":{"row":133,"column":24},"end":{"row":133,"column":48},"action":"remove","lines":["xtype: \"templatecolumn\","]},{"start":{"row":133,"column":24},"end":{"row":133,"column":47},"action":"insert","lines":["    if(filter.length) {"]},{"start":{"row":134,"column":24},"end":{"row":134,"column":89},"action":"remove","lines":["tpl: Ext.create(\"Rally.ui.renderer.template.FormattedIDTemplate\")"]},{"start":{"row":134,"column":24},"end":{"row":134,"column":69},"action":"insert","lines":["      store.filter(this._getReleaseFilter());"]},{"start":{"row":135,"column":20},"end":{"row":135,"column":23},"action":"remove","lines":["}, "]},{"start":{"row":135,"column":20},"end":{"row":135,"column":29},"action":"insert","lines":["        }"]},{"start":{"row":136,"column":13},"end":{"row":137,"column":0},"action":"remove","lines":["       {",""]},{"start":{"row":136,"column":24},"end":{"row":137,"column":0},"action":"insert","lines":["}",""]},{"start":{"row":137,"column":13},"end":{"row":138,"column":0},"action":"remove","lines":["text: \"Name\",",""]},{"start":{"row":137,"column":13},"end":{"row":137,"column":14},"action":"insert","lines":[" "]},{"start":{"row":137,"column":23},"end":{"row":138,"column":0},"action":"insert","lines":["",""]},{"start":{"row":138,"column":15},"end":{"row":139,"column":12},"action":"remove","lines":["dataIndex: \"Name\",","            "]},{"start":{"row":138,"column":15},"end":{"row":139,"column":0},"action":"insert","lines":["         // re-apply grid update listeners",""]},{"start":{"row":139,"column":12},"end":{"row":140,"column":0},"action":"remove","lines":["flex: 2",""]},{"start":{"row":139,"column":24},"end":{"row":139,"column":26},"action":"remove","lines":["  "]},{"start":{"row":139,"column":24},"end":{"row":140,"column":0},"action":"insert","lines":["var that = this;",""]},{"start":{"row":140,"column":6},"end":{"row":141,"column":0},"action":"remove","lines":["}, ",""]},{"start":{"row":140,"column":6},"end":{"row":140,"column":7},"action":"insert","lines":[" "]},{"start":{"row":140,"column":24},"end":{"row":141,"column":0},"action":"remove","lines":["   \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\", \"JobSize\", ",""]},{"start":{"row":140,"column":24},"end":{"row":141,"column":5},"action":"insert","lines":["store.addListener('update', function(store, rec, modified, opts) {","     "]},{"start":{"row":141,"column":25},"end":{"row":142,"column":0},"action":"remove","lines":["{",""]},{"start":{"row":141,"column":27},"end":{"row":142,"column":0},"action":"insert","lines":[" that._calculateScore([rec]);",""]},{"start":{"row":142,"column":22},"end":{"row":142,"column":41},"action":"remove","lines":["text: \"WSJF Score\","]},{"start":{"row":142,"column":22},"end":{"row":142,"column":27},"action":"insert","lines":["  });"]},{"start":{"row":143,"column":24},"end":{"row":144,"column":36},"action":"remove","lines":["dataIndex: \"WSJFScore\",","                        editor: null"]},{"start":{"row":143,"column":24},"end":{"row":145,"column":27},"action":"insert","lines":["store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });"]},{"start":{"row":147,"column":4},"end":{"row":148,"column":0},"action":"remove","lines":["            ]",""]},{"start":{"row":148,"column":12},"end":{"row":149,"column":0},"action":"remove","lines":["height: this.getHeight()",""]},{"start":{"row":148,"column":12},"end":{"row":149,"column":4},"action":"insert","lines":["    scope: this","    "]},{"start":{"row":150,"column":0},"end":{"row":151,"column":0},"action":"insert","lines":["        }",""]},{"start":{"row":220,"column":34},"end":{"row":235,"column":45},"action":"insert","lines":[";","    },","    ","    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : []"]}],[{"start":{"row":83,"column":11},"end":{"row":84,"column":0},"action":"insert","lines":["",""],"id":9081},{"start":{"row":84,"column":0},"end":{"row":84,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":84,"column":8},"end":{"row":95,"column":11},"action":"insert","lines":[" this._myButton = this.add({","            xtype : 'rallybutton',","            height : 20,","            text : 'Export to CSV',","            listeners : {","                scope :this,","                click : function() {","                    var exporter = Ext.create(\"GridExporter\",{});","                    exporter.exportGrid(app._myGrid);","                }","            }","        });"],"id":9082}],[{"start":{"row":96,"column":47},"end":{"row":97,"column":0},"action":"insert","lines":["",""],"id":9083},{"start":{"row":97,"column":0},"end":{"row":97,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":97,"column":8},"end":{"row":97,"column":9},"action":"insert","lines":["t"],"id":9084}],[{"start":{"row":97,"column":9},"end":{"row":97,"column":10},"action":"insert","lines":["h"],"id":9085}],[{"start":{"row":97,"column":10},"end":{"row":97,"column":11},"action":"insert","lines":["i"],"id":9086}],[{"start":{"row":97,"column":11},"end":{"row":97,"column":12},"action":"insert","lines":["s"],"id":9087}],[{"start":{"row":97,"column":12},"end":{"row":97,"column":13},"action":"insert","lines":["."],"id":9088}],[{"start":{"row":97,"column":13},"end":{"row":97,"column":14},"action":"insert","lines":["_"],"id":9089}],[{"start":{"row":97,"column":14},"end":{"row":97,"column":15},"action":"insert","lines":["b"],"id":9090}],[{"start":{"row":97,"column":13},"end":{"row":97,"column":15},"action":"remove","lines":["_b"],"id":9091},{"start":{"row":97,"column":13},"end":{"row":97,"column":26},"action":"insert","lines":["_boxcontainer"]}],[{"start":{"row":97,"column":26},"end":{"row":97,"column":27},"action":"insert","lines":["."],"id":9092}],[{"start":{"row":97,"column":27},"end":{"row":97,"column":28},"action":"insert","lines":["a"],"id":9093}],[{"start":{"row":97,"column":28},"end":{"row":97,"column":29},"action":"insert","lines":["d"],"id":9094}],[{"start":{"row":97,"column":29},"end":{"row":97,"column":30},"action":"insert","lines":["d"],"id":9095}],[{"start":{"row":97,"column":30},"end":{"row":97,"column":32},"action":"insert","lines":["()"],"id":9096}],[{"start":{"row":97,"column":31},"end":{"row":97,"column":32},"action":"insert","lines":["t"],"id":9097}],[{"start":{"row":97,"column":32},"end":{"row":97,"column":33},"action":"insert","lines":["h"],"id":9098}],[{"start":{"row":97,"column":33},"end":{"row":97,"column":34},"action":"insert","lines":["i"],"id":9099}],[{"start":{"row":97,"column":34},"end":{"row":97,"column":35},"action":"insert","lines":["s"],"id":9100}],[{"start":{"row":97,"column":35},"end":{"row":97,"column":36},"action":"insert","lines":["."],"id":9101}],[{"start":{"row":97,"column":36},"end":{"row":97,"column":37},"action":"insert","lines":["_"],"id":9102}],[{"start":{"row":97,"column":37},"end":{"row":97,"column":38},"action":"insert","lines":["m"],"id":9103}],[{"start":{"row":97,"column":36},"end":{"row":97,"column":38},"action":"remove","lines":["_m"],"id":9104},{"start":{"row":97,"column":36},"end":{"row":97,"column":45},"action":"insert","lines":["_myButton"]}],[{"start":{"row":97,"column":46},"end":{"row":97,"column":47},"action":"insert","lines":[";"],"id":9105}],[{"start":{"row":2,"column":28},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":9106},{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":3,"column":4},"end":{"row":6,"column":24},"action":"insert","lines":["uses: [","        'Ext.ux.exporter.Exporter'","    ],","    componentCls: 'app',"],"id":9107}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":24},"action":"remove","lines":["    componentCls: 'app',"],"id":9108}],[{"start":{"row":0,"column":36},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":9109}],[{"start":{"row":1,"column":0},"end":{"row":1,"column":15},"action":"insert","lines":["var app = null;"],"id":9110}],[{"start":{"row":64,"column":32},"end":{"row":65,"column":0},"action":"insert","lines":["",""],"id":9111},{"start":{"row":65,"column":0},"end":{"row":65,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":65,"column":8},"end":{"row":65,"column":9},"action":"insert","lines":["v"],"id":9112}],[{"start":{"row":65,"column":9},"end":{"row":65,"column":10},"action":"insert","lines":["a"],"id":9113}],[{"start":{"row":65,"column":10},"end":{"row":65,"column":11},"action":"insert","lines":["r"],"id":9114}],[{"start":{"row":65,"column":11},"end":{"row":65,"column":12},"action":"insert","lines":[" "],"id":9115}],[{"start":{"row":65,"column":12},"end":{"row":65,"column":13},"action":"insert","lines":["a"],"id":9116}],[{"start":{"row":65,"column":13},"end":{"row":65,"column":14},"action":"insert","lines":["p"],"id":9117}],[{"start":{"row":65,"column":14},"end":{"row":65,"column":15},"action":"insert","lines":["p"],"id":9118}],[{"start":{"row":65,"column":15},"end":{"row":65,"column":16},"action":"insert","lines":[" "],"id":9119}],[{"start":{"row":65,"column":16},"end":{"row":65,"column":17},"action":"insert","lines":["="],"id":9120}],[{"start":{"row":65,"column":17},"end":{"row":65,"column":18},"action":"insert","lines":[" "],"id":9121}],[{"start":{"row":65,"column":18},"end":{"row":65,"column":19},"action":"insert","lines":["t"],"id":9122}],[{"start":{"row":65,"column":19},"end":{"row":65,"column":20},"action":"insert","lines":["h"],"id":9123}],[{"start":{"row":65,"column":20},"end":{"row":65,"column":21},"action":"insert","lines":["i"],"id":9124}],[{"start":{"row":65,"column":21},"end":{"row":65,"column":22},"action":"insert","lines":["s"],"id":9125}],[{"start":{"row":65,"column":22},"end":{"row":65,"column":23},"action":"insert","lines":[";"],"id":9126}],[{"start":{"row":0,"column":0},"end":{"row":257,"column":0},"action":"remove","lines":["var Ext = window.Ext4 || window.Ext;","var app = null;","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    uses: [","        'Ext.ux.exporter.Exporter'","    ],","","    componentCls: 'app',","    //items:{ html:'<a href=\"https://help.rallydev.com/apps/2.0/doc/\">App SDK 2.0 Docs</a>'},","    launch: function() {","        this._boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        var app = this;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","        this._boxcontainer.add(this._piCombobox); //new","        this._checkbox = this.add({","            xtype: 'rallycheckboxfield',","            fieldLabel: 'Show Values After the Decimal',","            labelWidth: 200,","            padding: '5, 5, 5, 10',","            stateful: true,","            stateId: this.getContext().getScopedStateId('mycheckbox'),","            stateEvents: ['change'],","            value: false,","            listeners: {","                change: this._onPICombobox,","                scope: this","            }","        });","         this._myButton = this.add({","            xtype : 'rallybutton',","            height : 20,","            text : 'Export to CSV',","            listeners : {","                scope :this,","                click : function() {","                    var exporter = Ext.create(\"GridExporter\",{});","                    exporter.exportGrid(app._myGrid);","                }","            }","        });","        this._boxcontainer.add(this._checkbox);","        this._boxcontainer.add(this._myButton);","        this.add(this._boxcontainer);","    },","","    _onPICombobox: function() {","        if( this._piCombobox ) {","            var selectedType = this._piCombobox.getRecord();","            if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }","        ","            Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),","                success: function(model){","                    if (this._myGrid === undefined) {","                        Ext.create(\"Rally.data.WsapiDataStore\", {","                            model: model,","                            autoLoad: true,","                            filters: this._getReleaseFilter(),","                            remoteSort: false,","                            listeners: {","                                load: function(store, records, success) {","                                    this._calculateScore(records);","                                    this._updateGrid(store);","                                },","                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },","                                scope: this","                            },","                            fetch: [\"Name\", \"FormattedID\", \"Release\", ","                                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\",","                                \"WSJFScore\", \"JobSize\"]","                        });","                    }","                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel(model);","                        ","                        // clear and re-apply filter since reconfiguring model ","                        // doesn't do this","                        var store = this._myGrid.getStore();","                         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();","                    ","                            store.clearFilter(filter.length > 0);","                            if(filter.length) {","                              store.filter(this._getReleaseFilter());","                            }","                        }","                       ","                        // re-apply grid update listeners","                        var that = this;","                        store.addListener('update', function(store, rec, modified, opts) {","                            that._calculateScore([rec]);","                        });","                        store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });","                    }","                },","                scope: this","            });","        }","    },","    ","    _calculateScore: function(records) {","        var that = this;","        Ext.Array.each(records, function(feature) {","            //console.log(\"feature\", feature.data);","            var jobSize = feature.data.JobSize;","            var timeValue = feature.data.TimeCriticality;","            var OERR = feature.data.RROEValue;","            var userValue = feature.data.UserBusinessValue;","            var oldScore = feature.data.WSJFScore;","            var isChecked = false;","            if( that._checkbox) {","                isChecked = that._checkbox.getValue();","            }","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = Math.floor(((userValue + timeValue + OERR ) / jobSize) + 0.5);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) / jobSize) * 100)/100;","                }","","                if (oldScore !== score) { // only update if score changed","                    feature.set('WSJFScore', score); // set score value in db","                }","            }","        });","    },","    ","    _createGrid: function(myStore) {","        this._myGrid = Ext.create(\"Rally.ui.grid.Grid\", {","            xtype: \"rallygrid\",","            title: \"Feature Scoring Grid\",","            showPagingToolbar: true,","            pagingToolbarCfg: {","               pageSizes: [50, 100, 200, 500, 1000]","            },","            height: \"98%\",","            width: \"98%\",","            store: myStore,","            enableBulkEdit: true,","            enableRanking: true,","            defaultSortToRank: true,","            selType: \"cellmodel\",","            columnCfgs: [","                {","                    text: \"Portfolio ID\",","                    dataIndex: \"FormattedID\",","                    flex: 1,","                    xtype: \"templatecolumn\",","                    tpl: Ext.create(\"Rally.ui.renderer.template.FormattedIDTemplate\")","                }, ","                {","                    text: \"Name\",","                    dataIndex: \"Name\",","                    flex: 2","                }, ","                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\", \"JobSize\", ","                {","                    text: \"WSJF Score\",","                    dataIndex: \"WSJFScore\",","                    editor: null","                }","            ],","            scope: this","        }), this.add(this._myGrid);","    },","    ","    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : [];","    }","});",""],"id":9126},{"start":{"row":0,"column":0},"end":{"row":228,"column":0},"action":"insert","lines":["var Ext = window.Ext4 || window.Ext;","Ext.define('CustomApp', {","    extend: 'Rally.app.App',","    componentCls: 'app',","    launch: function() {","        var that = this;","","        // console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        console.log(\"grid: \", this._grid);","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            console.log(\"destroying grid\");","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    console.log(\"loading\");","                    this._calculateScore(records);","                },","                update: function(store, rec, modified, opts) {","                    console.log(\"updating\");","                    this._calculateScore([rec]);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","","        console.log(\"loading:\", records);","        //this._calculateScore(records);","  ","        console.log(\"Store Built\");","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardcustomfiltercontrol',","                    filterChildren: false,","                    filterControlConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example')","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = Rally.ui.grid.GridCsvExport.buildCsvExportUrl(","                                    this.down('rallygridboard').getGridOrBoard());","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    'TimeCriticality', 'RROEValue', 'UserBusinessValue', 'JobSize', ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: \"WSJFScore\",","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records)  {","        var that = this;","        console.log(\"Calculate Score\");","        Ext.Array.each(records, function(feature) {","            console.log(\"Calc Score Feature: \", feature.data);","            var jobSize = feature.data.JobSize;","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            var OERR      = feature.data[that.RROEValueField];","            var userValue = feature.data[that.UserBusinessValueField];","            var oldScore  = feature.data[that.WSJFScoreField];","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","","                if (oldScore !== score) { // only update if score changed","                    feature.set('WSJFScore', score); // set score value in db","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'","        }","    }","});",""]}],[{"start":{"row":28,"column":0},"end":{"row":28,"column":42},"action":"remove","lines":["        console.log(\"grid: \", this._grid);"],"id":9128}],[{"start":{"row":27,"column":31},"end":{"row":28,"column":0},"action":"remove","lines":["",""],"id":9129}],[{"start":{"row":32,"column":0},"end":{"row":32,"column":43},"action":"remove","lines":["            console.log(\"destroying grid\");"],"id":9130}],[{"start":{"row":31,"column":34},"end":{"row":32,"column":0},"action":"remove","lines":["",""],"id":9131}],[{"start":{"row":40,"column":0},"end":{"row":40,"column":43},"action":"remove","lines":["                    console.log(\"loading\");"],"id":9132}],[{"start":{"row":39,"column":65},"end":{"row":40,"column":0},"action":"remove","lines":["",""],"id":9133}],[{"start":{"row":43,"column":0},"end":{"row":43,"column":44},"action":"remove","lines":["                    console.log(\"updating\");"],"id":9134}],[{"start":{"row":42,"column":62},"end":{"row":43,"column":0},"action":"remove","lines":["",""],"id":9135}],[{"start":{"row":58,"column":0},"end":{"row":59,"column":40},"action":"remove","lines":["        console.log(\"loading:\", records);","        //this._calculateScore(records);"],"id":9136}],[{"start":{"row":57,"column":0},"end":{"row":58,"column":0},"action":"remove","lines":["",""],"id":9137}],[{"start":{"row":56,"column":55},"end":{"row":57,"column":0},"action":"remove","lines":["",""],"id":9138}],[{"start":{"row":58,"column":0},"end":{"row":58,"column":35},"action":"remove","lines":["        console.log(\"Store Built\");"],"id":9139}],[{"start":{"row":57,"column":2},"end":{"row":58,"column":0},"action":"remove","lines":["",""],"id":9140}],[{"start":{"row":121,"column":0},"end":{"row":121,"column":39},"action":"remove","lines":["        console.log(\"Calculate Score\");"],"id":9141}],[{"start":{"row":123,"column":0},"end":{"row":123,"column":62},"action":"remove","lines":["            console.log(\"Calc Score Feature: \", feature.data);"],"id":9142}],[{"start":{"row":122,"column":51},"end":{"row":123,"column":0},"action":"remove","lines":["",""],"id":9143}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":7,"column":11},"end":{"row":7,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1442410878308,"hash":"40713736d3881b086cb976548c87b2edb55dbd19"}