{"filter":false,"title":"App-uncompressed.html","tooltip":"/deploy/App-uncompressed.html","undoManager":{"mark":62,"position":62,"stack":[[{"start":{"row":122,"column":0},"end":{"row":123,"column":0},"action":"remove","lines":["                                ",""],"id":1},{"start":{"row":123,"column":42},"end":{"row":123,"column":57},"action":"remove","lines":["updateGrid([sto"]},{"start":{"row":123,"column":42},"end":{"row":123,"column":58},"action":"insert","lines":["calculateScore(["]},{"start":{"row":123,"column":60},"end":{"row":123,"column":61},"action":"insert","lines":["c"]},{"start":{"row":207,"column":0},"end":{"row":210,"column":0},"action":"remove","lines":["            listeners: {","                //update: this._calculateScore(myStore)","            },",""]}],[{"start":{"row":123,"column":0},"end":{"row":124,"column":0},"action":"insert","lines":["                                    console.log(\"updated rec, modified: \", rec, modified);",""],"id":2}],[{"start":{"row":123,"column":0},"end":{"row":124,"column":0},"action":"remove","lines":["                                    console.log(\"updated rec, modified: \", rec, modified);",""],"id":3},{"start":{"row":187,"column":0},"end":{"row":188,"column":0},"action":"insert","lines":["                console.log(\"oldScore, score: \", oldScore, score);",""]}],[{"start":{"row":171,"column":0},"end":{"row":172,"column":0},"action":"insert","lines":["            console.log(\"JobSize: \", jobSize, \" timeValue: \", timeValue, \" OERR: \", OERR, \" userValue: \", userValue);",""],"id":4},{"start":{"row":188,"column":16},"end":{"row":188,"column":22},"action":"insert","lines":["    //"]}],[{"start":{"row":73,"column":16},"end":{"row":73,"column":18},"action":"remove","lines":["//"],"id":5,"ignore":true},{"start":{"row":171,"column":0},"end":{"row":172,"column":0},"action":"remove","lines":["            console.log(\"JobSize: \", jobSize, \" timeValue: \", timeValue, \" OERR: \", OERR, \" userValue: \", userValue);",""]},{"start":{"row":187,"column":0},"end":{"row":188,"column":0},"action":"remove","lines":["                    //console.log(\"oldScore, score: \", oldScore, score);",""]}],[{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"remove","lines":["W"],"id":6,"ignore":true},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"insert","lines":["w"]},{"start":{"row":112,"column":52},"end":{"row":112,"column":61},"action":"remove","lines":["DataStore"]},{"start":{"row":112,"column":52},"end":{"row":112,"column":69},"action":"insert","lines":[".TreeStoreBuilder"]},{"start":{"row":195,"column":25},"end":{"row":195,"column":29},"action":"insert","lines":["tree"]}],[{"start":{"row":115,"column":0},"end":{"row":116,"column":0},"action":"insert","lines":["                            enableHierarchy: false,",""],"id":7,"ignore":true},{"start":{"row":164,"column":0},"end":{"row":165,"column":0},"action":"insert","lines":["        console.log(\"calculating score\");",""]},{"start":{"row":196,"column":0},"end":{"row":197,"column":0},"action":"insert","lines":["        console.log(\"creating grid\");",""]}],[{"start":{"row":197,"column":35},"end":{"row":197,"column":53},"action":"remove","lines":["Rally.ui.grid.Grid"],"id":8,"ignore":true},{"start":{"row":197,"column":35},"end":{"row":197,"column":48},"action":"insert","lines":["Ext.Container"]}],[{"start":{"row":167,"column":12},"end":{"row":167,"column":14},"action":"remove","lines":["//"],"id":9,"ignore":true}],[{"start":{"row":56,"column":49},"end":{"row":56,"column":50},"action":"remove","lines":[","],"id":10,"ignore":true},{"start":{"row":56,"column":49},"end":{"row":56,"column":50},"action":"insert","lines":[";"]},{"start":{"row":57,"column":16},"end":{"row":58,"column":24},"action":"insert","lines":["if ( grid ) {","                    var "]},{"start":{"row":58,"column":47},"end":{"row":59,"column":0},"action":"remove","lines":[",",""]},{"start":{"row":58,"column":47},"end":{"row":59,"column":2},"action":"insert","lines":[";","  "]},{"start":{"row":59,"column":18},"end":{"row":59,"column":24},"action":"insert","lines":["  var "]},{"start":{"row":60,"column":8},"end":{"row":61,"column":0},"action":"remove","lines":["",""]},{"start":{"row":60,"column":8},"end":{"row":61,"column":1},"action":"insert","lines":["    "," "]},{"start":{"row":61,"column":17},"end":{"row":61,"column":20},"action":"insert","lines":["   "]},{"start":{"row":62,"column":16},"end":{"row":62,"column":20},"action":"insert","lines":["    "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"insert","lines":["    "]},{"start":{"row":64,"column":0},"end":{"row":65,"column":0},"action":"insert","lines":["                    }",""]}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":38},"action":"insert","lines":["console.log(\"creating store\");"],"id":11,"ignore":true}],[{"start":{"row":122,"column":0},"end":{"row":123,"column":0},"action":"insert","lines":["                                    console.log(\"loading store\");",""],"id":12,"ignore":true}],[{"start":{"row":113,"column":0},"end":{"row":114,"column":0},"action":"insert","lines":["                    console.log(\"successfully loaded store\");",""],"id":13,"ignore":true},{"start":{"row":240,"column":0},"end":{"row":241,"column":0},"action":"insert","lines":["        console.log(\"updating grid\");",""]}],[{"start":{"row":56,"column":49},"end":{"row":58,"column":1},"action":"remove","lines":[";","                if ( grid ) {"," "],"id":14,"ignore":true},{"start":{"row":56,"column":49},"end":{"row":57,"column":0},"action":"insert","lines":[",",""]},{"start":{"row":57,"column":16},"end":{"row":57,"column":23},"action":"remove","lines":["   var "]},{"start":{"row":57,"column":39},"end":{"row":58,"column":2},"action":"remove","lines":[";","  "]},{"start":{"row":57,"column":39},"end":{"row":58,"column":0},"action":"insert","lines":[",",""]},{"start":{"row":58,"column":16},"end":{"row":58,"column":22},"action":"remove","lines":["  var "]},{"start":{"row":59,"column":8},"end":{"row":60,"column":1},"action":"remove","lines":["    "," "]},{"start":{"row":59,"column":8},"end":{"row":60,"column":0},"action":"insert","lines":["",""]},{"start":{"row":60,"column":16},"end":{"row":60,"column":19},"action":"remove","lines":["   "]},{"start":{"row":61,"column":16},"end":{"row":61,"column":20},"action":"remove","lines":["    "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":4},"action":"remove","lines":["    "]},{"start":{"row":63,"column":0},"end":{"row":64,"column":0},"action":"remove","lines":["                    }",""]},{"start":{"row":107,"column":8},"end":{"row":107,"column":38},"action":"remove","lines":["console.log(\"creating store\");"]},{"start":{"row":111,"column":0},"end":{"row":112,"column":0},"action":"remove","lines":["                    console.log(\"successfully loaded store\");",""]},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"remove","lines":["w"]},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"insert","lines":["W"]},{"start":{"row":112,"column":52},"end":{"row":112,"column":69},"action":"remove","lines":[".TreeStoreBuilder"]},{"start":{"row":112,"column":52},"end":{"row":112,"column":61},"action":"insert","lines":["DataStore"]},{"start":{"row":115,"column":0},"end":{"row":116,"column":0},"action":"remove","lines":["                            enableHierarchy: false,",""]},{"start":{"row":119,"column":0},"end":{"row":120,"column":0},"action":"remove","lines":["                                    console.log(\"loading store\");",""]},{"start":{"row":163,"column":0},"end":{"row":164,"column":0},"action":"remove","lines":["        console.log(\"calculating score\");",""]},{"start":{"row":165,"column":12},"end":{"row":165,"column":14},"action":"insert","lines":["//"]},{"start":{"row":194,"column":0},"end":{"row":195,"column":0},"action":"remove","lines":["        console.log(\"creating grid\");",""]},{"start":{"row":194,"column":35},"end":{"row":194,"column":48},"action":"remove","lines":["Ext.Container"]},{"start":{"row":194,"column":35},"end":{"row":194,"column":53},"action":"insert","lines":["Rally.ui.grid.Grid"]},{"start":{"row":195,"column":25},"end":{"row":195,"column":29},"action":"remove","lines":["tree"]},{"start":{"row":232,"column":36},"end":{"row":233,"column":37},"action":"remove","lines":["","        console.log(\"updating grid\");"]}],[{"start":{"row":194,"column":48},"end":{"row":194,"column":53},"action":"remove","lines":[".Grid"],"id":15,"ignore":true},{"start":{"row":194,"column":48},"end":{"row":194,"column":67},"action":"insert","lines":["board.GridBoardView"]},{"start":{"row":195,"column":29},"end":{"row":195,"column":34},"action":"insert","lines":["board"]}],[{"start":{"row":194,"column":48},"end":{"row":194,"column":67},"action":"remove","lines":["board.GridBoardView"],"id":16,"ignore":true},{"start":{"row":194,"column":48},"end":{"row":194,"column":53},"action":"insert","lines":[".Grid"]},{"start":{"row":195,"column":29},"end":{"row":195,"column":34},"action":"remove","lines":["board"]}],[{"start":{"row":15,"column":14},"end":{"row":69,"column":14},"action":"remove","lines":["boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        this._"],"id":17,"ignore":true},{"start":{"row":24,"column":8},"end":{"row":24,"column":55},"action":"remove","lines":["this._boxcontainer.add(this._piCombobox); //new"]},{"start":{"row":39,"column":4},"end":{"row":41,"column":6},"action":"remove","lines":["    this._boxcontainer.add(this._checkbox);","        this.add(this._boxcontainer);","    },"]},{"start":{"row":39,"column":4},"end":{"row":39,"column":19},"action":"insert","lines":["}, //end launch"]},{"start":{"row":44,"column":0},"end":{"row":51,"column":0},"action":"remove","lines":["            if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }",""]},{"start":{"row":52,"column":0},"end":{"row":53,"column":0},"action":"remove","lines":["                            filters: this._getReleaseFilter(),",""]},{"start":{"row":70,"column":24},"end":{"row":81,"column":25},"action":"remove","lines":["","                        // clear and re-apply filter since reconfiguring model ","                        // doesn't do this","                        var store = this._myGrid.getStore();","                         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();","                    ","                            store.clearFilter(filter.length > 0);","                            if(filter.length) {","                              store.filter(this._getReleaseFilter());","                            }","                        }"]},{"start":{"row":70,"column":24},"end":{"row":70,"column":60},"action":"insert","lines":["var store = this._myGrid.getStore();"]},{"start":{"row":163,"column":9},"end":{"row":169,"column":46},"action":"remove","lines":["","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : [];"]}],[{"start":{"row":119,"column":48},"end":{"row":119,"column":52},"action":"remove","lines":[".Gri"],"id":18,"ignore":true},{"start":{"row":119,"column":48},"end":{"row":119,"column":62},"action":"insert","lines":["board.GridBoar"]},{"start":{"row":120,"column":29},"end":{"row":121,"column":39},"action":"remove","lines":["\",","            title: \"Feature Scoring Gri"]},{"start":{"row":120,"column":29},"end":{"row":120,"column":33},"action":"insert","lines":["boar"]},{"start":{"row":129,"column":0},"end":{"row":131,"column":0},"action":"remove","lines":["            enableRanking: true,","            defaultSortToRank: true,",""]}],[{"start":{"row":42,"column":0},"end":{"row":48,"column":0},"action":"insert","lines":["         if ( this._myGrid ) {","            var store = this._myGrid.getStore();","            store.clearFilter(!0);","            this._myGrid.destroy();","        }","        ",""],"id":19,"ignore":true},{"start":{"row":62,"column":42},"end":{"row":62,"column":45},"action":"remove","lines":["upd"]},{"start":{"row":62,"column":42},"end":{"row":62,"column":45},"action":"insert","lines":["cre"]},{"start":{"row":64,"column":0},"end":{"row":67,"column":0},"action":"remove","lines":["                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },",""]},{"start":{"row":71,"column":0},"end":{"row":84,"column":0},"action":"remove","lines":["                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel(model);","                        var store = this._myGrid.getStore();","                       ","                        // re-apply grid update listeners","                        var that = this;","                        store.addListener('update', function(store, rec, modified, opts) {","                            that._calculateScore([rec]);","                        });","                        store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });","                    }",""]},{"start":{"row":141,"column":12},"end":{"row":141,"column":35},"action":"remove","lines":["this.add(this._myGrid);"]},{"start":{"row":142,"column":4},"end":{"row":143,"column":0},"action":"remove","lines":["},",""]},{"start":{"row":142,"column":8},"end":{"row":149,"column":9},"action":"remove","lines":["","    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }"]},{"start":{"row":142,"column":8},"end":{"row":142,"column":31},"action":"insert","lines":["this.add(this._myGrid);"]}],[{"start":{"row":120,"column":12},"end":{"row":120,"column":21},"action":"remove","lines":["columnCfg"],"id":20,"ignore":true},{"start":{"row":120,"column":12},"end":{"row":120,"column":18},"action":"insert","lines":["plugin"]},{"start":{"row":122,"column":0},"end":{"row":134,"column":4},"action":"insert","lines":["                    ptype: 'rallygridboardcustomfiltercontrol',","                    filterControlConfig: {","                        modelNames: myStore.getModel,","                        stateful: true,","                        stateId: this.getContext().getScopedStateId('custom-filter-grid')","                    }","                }","            ],","            gridConfig: {","                store: myStore,","                columnCfgs: [","                    {","    "]},{"start":{"row":135,"column":0},"end":{"row":135,"column":4},"action":"insert","lines":["    "]},{"start":{"row":136,"column":20},"end":{"row":136,"column":23},"action":"insert","lines":["   "]},{"start":{"row":136,"column":23},"end":{"row":136,"column":24},"action":"insert","lines":[" "]},{"start":{"row":137,"column":0},"end":{"row":137,"column":4},"action":"insert","lines":["    "]},{"start":{"row":138,"column":20},"end":{"row":138,"column":23},"action":"insert","lines":["   "]},{"start":{"row":138,"column":23},"end":{"row":138,"column":24},"action":"insert","lines":[" "]},{"start":{"row":139,"column":16},"end":{"row":140,"column":0},"action":"remove","lines":["}, ",""]},{"start":{"row":139,"column":16},"end":{"row":140,"column":4},"action":"insert","lines":["    }, ","    "]},{"start":{"row":141,"column":20},"end":{"row":141,"column":24},"action":"insert","lines":["    "]},{"start":{"row":142,"column":0},"end":{"row":142,"column":4},"action":"insert","lines":["    "]},{"start":{"row":143,"column":20},"end":{"row":143,"column":24},"action":"insert","lines":["    "]},{"start":{"row":144,"column":16},"end":{"row":145,"column":0},"action":"remove","lines":["}, ",""]},{"start":{"row":144,"column":16},"end":{"row":145,"column":4},"action":"insert","lines":["    }, ","    "]},{"start":{"row":146,"column":16},"end":{"row":146,"column":20},"action":"insert","lines":["    "]},{"start":{"row":147,"column":20},"end":{"row":147,"column":21},"action":"insert","lines":[" "]},{"start":{"row":147,"column":21},"end":{"row":147,"column":24},"action":"insert","lines":["   "]},{"start":{"row":148,"column":0},"end":{"row":148,"column":4},"action":"insert","lines":["    "]},{"start":{"row":149,"column":20},"end":{"row":149,"column":22},"action":"insert","lines":["  "]},{"start":{"row":149,"column":22},"end":{"row":149,"column":24},"action":"insert","lines":["  "]},{"start":{"row":150,"column":16},"end":{"row":151,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":150,"column":16},"end":{"row":151,"column":2},"action":"insert","lines":["    }","  "]},{"start":{"row":151,"column":14},"end":{"row":151,"column":15},"action":"remove","lines":["]"]},{"start":{"row":151,"column":14},"end":{"row":152,"column":13},"action":"insert","lines":["  ]","            }"]}],[{"start":{"row":55,"column":23},"end":{"row":65,"column":25},"action":"insert","lines":[" ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: true","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    });","                        ////","                       /*"],"id":21,"ignore":true},{"start":{"row":79,"column":27},"end":{"row":79,"column":29},"action":"insert","lines":["*/"]},{"start":{"row":87,"column":0},"end":{"row":91,"column":0},"action":"insert","lines":["    _onStoreBuilt: function(store) {","        console.log(\"Store: \", store);","    },","    ",""]}],[{"start":{"row":59,"column":41},"end":{"row":59,"column":44},"action":"remove","lines":["tru"],"id":22,"ignore":true},{"start":{"row":59,"column":41},"end":{"row":59,"column":45},"action":"insert","lines":["fals"]}],[{"start":{"row":87,"column":33},"end":{"row":87,"column":42},"action":"insert","lines":[", records"],"id":23,"ignore":true},{"start":{"row":89,"column":0},"end":{"row":90,"column":0},"action":"insert","lines":["        console.log(\"Records: \", records);",""]}],[{"start":{"row":55,"column":23},"end":{"row":65,"column":25},"action":"remove","lines":[" ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: false","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    });","                        ////","                       /*"],"id":24,"ignore":true},{"start":{"row":69,"column":27},"end":{"row":69,"column":29},"action":"remove","lines":["*/"]},{"start":{"row":114,"column":48},"end":{"row":114,"column":62},"action":"remove","lines":["board.GridBoar"]},{"start":{"row":114,"column":48},"end":{"row":114,"column":52},"action":"insert","lines":[".Gri"]}],[{"start":{"row":77,"column":33},"end":{"row":77,"column":42},"action":"remove","lines":[", records"],"id":25,"ignore":true},{"start":{"row":79,"column":0},"end":{"row":80,"column":0},"action":"remove","lines":["        console.log(\"Records: \", records);",""]},{"start":{"row":113,"column":48},"end":{"row":113,"column":52},"action":"remove","lines":[".Gri"]},{"start":{"row":113,"column":48},"end":{"row":113,"column":62},"action":"insert","lines":["board.GridBoar"]},{"start":{"row":114,"column":29},"end":{"row":114,"column":34},"action":"remove","lines":["board"]}],[{"start":{"row":55,"column":23},"end":{"row":75,"column":25},"action":"insert","lines":[" ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: false","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    });","                        ////","                       /*                        ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: true","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    });","                        ////","                       /*"],"id":26,"ignore":true},{"start":{"row":89,"column":27},"end":{"row":89,"column":29},"action":"insert","lines":["*/"]},{"start":{"row":134,"column":29},"end":{"row":134,"column":34},"action":"insert","lines":["board"]}],[{"start":{"row":98,"column":36},"end":{"row":98,"column":61},"action":"insert","lines":[".getRootNode().childNodes"],"id":27,"ignore":true}],[{"start":{"row":98,"column":8},"end":{"row":98,"column":61},"action":"remove","lines":["console.log(\"Store: \", store.getRootNode().childNodes"],"id":28,"ignore":true},{"start":{"row":98,"column":8},"end":{"row":100,"column":34},"action":"insert","lines":["var root = store.getRootNode();","        console.log(\"Store: \", store);","        console.log(\"root: \", root"]}],[{"start":{"row":135,"column":0},"end":{"row":138,"column":0},"action":"insert","lines":["        var context = this.getContext();","        var model = myStore.getModel();","        ",""],"id":29,"ignore":true},{"start":{"row":147,"column":0},"end":{"row":150,"column":0},"action":"insert","lines":["            model: model,","            context: context,","            toggleState: 'grid',",""]},{"start":{"row":156,"column":37},"end":{"row":156,"column":48},"action":"remove","lines":["yStore.getM"]}],[{"start":{"row":15,"column":14},"end":{"row":69,"column":14},"action":"insert","lines":["boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        this._"],"id":30,"ignore":true},{"start":{"row":78,"column":8},"end":{"row":78,"column":55},"action":"insert","lines":["this._boxcontainer.add(this._piCombobox); //new"]},{"start":{"row":93,"column":4},"end":{"row":100,"column":3},"action":"remove","lines":["}, //end launch","","    _onPICombobox: function() {","         if ( this._myGrid ) {","            var store = this._myGrid.getStore();","            store.clearFilter(!0);","            this._myGrid.destroy();","   "]},{"start":{"row":93,"column":4},"end":{"row":95,"column":0},"action":"insert","lines":["    this._boxcontainer.add(this._checkbox);","        this.add(this._boxcontainer);",""]},{"start":{"row":95,"column":4},"end":{"row":95,"column":5},"action":"remove","lines":[" "]},{"start":{"row":95,"column":5},"end":{"row":96,"column":0},"action":"insert","lines":[",",""]},{"start":{"row":97,"column":4},"end":{"row":97,"column":8},"action":"remove","lines":["    "]},{"start":{"row":97,"column":4},"end":{"row":97,"column":31},"action":"insert","lines":["_onPICombobox: function() {"]},{"start":{"row":100,"column":8},"end":{"row":101,"column":1},"action":"remove","lines":[""," "]},{"start":{"row":100,"column":12},"end":{"row":112,"column":21},"action":"remove","lines":["       Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),","                success: function(model){","                    if (this._myGrid === undefined) {","                        ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: false","                    }).then({","                        success: this._onStoreBuilt,","                        scope: this","                    }"]},{"start":{"row":100,"column":12},"end":{"row":105,"column":45},"action":"insert","lines":["if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable("]},{"start":{"row":106,"column":12},"end":{"row":106,"column":14},"action":"remove","lines":["  "]},{"start":{"row":106,"column":12},"end":{"row":113,"column":6},"action":"remove","lines":["          ////","                       /*                        ////","                        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                        model: model,","                        autoLoad: true,","                        enableHierarchy: true","                    }).then({","      "]},{"start":{"row":106,"column":12},"end":{"row":110,"column":0},"action":"insert","lines":["}","        ","            Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),",""]},{"start":{"row":110,"column":16},"end":{"row":110,"column":18},"action":"remove","lines":["  "]},{"start":{"row":110,"column":25},"end":{"row":110,"column":44},"action":"remove","lines":["this._onStoreBuilt,"]},{"start":{"row":110,"column":25},"end":{"row":110,"column":41},"action":"insert","lines":["function(model){"]},{"start":{"row":111,"column":20},"end":{"row":113,"column":28},"action":"remove","lines":["    scope: this","                    });","                        ////"]},{"start":{"row":111,"column":20},"end":{"row":111,"column":53},"action":"insert","lines":["if (this._myGrid === undefined) {"]},{"start":{"row":112,"column":23},"end":{"row":112,"column":25},"action":"remove","lines":["/*"]},{"start":{"row":115,"column":0},"end":{"row":116,"column":0},"action":"insert","lines":["                            filters: this._getReleaseFilter(),",""]},{"start":{"row":120,"column":42},"end":{"row":120,"column":58},"action":"remove","lines":["createGrid(store"]},{"start":{"row":120,"column":42},"end":{"row":123,"column":62},"action":"insert","lines":["updateGrid(store);","                                },","                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]"]},{"start":{"row":130,"column":27},"end":{"row":130,"column":29},"action":"remove","lines":["*/"]},{"start":{"row":132,"column":16},"end":{"row":134,"column":0},"action":"remove","lines":["},","                scope: this",""]},{"start":{"row":132,"column":16},"end":{"row":134,"column":1},"action":"insert","lines":["    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel(model);"," "]},{"start":{"row":134,"column":13},"end":{"row":135,"column":0},"action":"remove","lines":["});",""]},{"start":{"row":134,"column":13},"end":{"row":134,"column":16},"action":"insert","lines":["   "]},{"start":{"row":134,"column":24},"end":{"row":134,"column":25},"action":"remove","lines":["}"]},{"start":{"row":135,"column":0},"end":{"row":135,"column":2},"action":"insert","lines":["  "]},{"start":{"row":135,"column":6},"end":{"row":136,"column":0},"action":"remove","lines":["},",""]},{"start":{"row":135,"column":6},"end":{"row":135,"column":9},"action":"insert","lines":["   "]},{"start":{"row":135,"column":13},"end":{"row":136,"column":0},"action":"remove","lines":["",""]},{"start":{"row":135,"column":17},"end":{"row":136,"column":36},"action":"remove","lines":["_onStoreBuilt: function(store) {","        var root = store.getRootNode"]},{"start":{"row":135,"column":17},"end":{"row":143,"column":65},"action":"insert","lines":["       // clear and re-apply filter since reconfiguring model ","                        // doesn't do this","                        var store = this._myGrid.getStore();","                         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();","                    ","                            store.clearFilter(filter.length > 0);","                            if(filter.length) {","                              store.filter(this._getReleaseFilter"]},{"start":{"row":143,"column":67},"end":{"row":143,"column":68},"action":"insert","lines":[")"]},{"start":{"row":144,"column":8},"end":{"row":145,"column":36},"action":"remove","lines":["console.log(\"Store: \", store);","        console.log(\"root: \", root);"]},{"start":{"row":144,"column":8},"end":{"row":159,"column":9},"action":"insert","lines":["                    }","                        }","                       ","                        // re-apply grid update listeners","                        var that = this;","                        store.addListener('update', function(store, rec, modified, opts) {","                            that._calculateScore([rec]);","                        });","                        store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });","                    }","                },","                scope: this","            });","        }"]},{"start":{"row":194,"column":0},"end":{"row":197,"column":0},"action":"remove","lines":["        var context = this.getContext();","        var model = myStore.getModel();","        ",""]},{"start":{"row":194,"column":48},"end":{"row":194,"column":62},"action":"remove","lines":["board.GridBoar"]},{"start":{"row":194,"column":48},"end":{"row":194,"column":52},"action":"insert","lines":[".Gri"]},{"start":{"row":195,"column":29},"end":{"row":195,"column":33},"action":"remove","lines":["boar"]},{"start":{"row":195,"column":29},"end":{"row":196,"column":39},"action":"insert","lines":["\",","            title: \"Feature Scoring Gri"]},{"start":{"row":204,"column":12},"end":{"row":209,"column":16},"action":"remove","lines":["model: model,","            context: context,","            toggleState: 'grid',","            enableBulkEdit: true,","            selType: \"cellmodel\",","            plug"]},{"start":{"row":204,"column":12},"end":{"row":205,"column":22},"action":"insert","lines":["enableBulkEdit: true,","            enableRank"]},{"start":{"row":205,"column":24},"end":{"row":205,"column":25},"action":"remove","lines":["s"]},{"start":{"row":205,"column":24},"end":{"row":205,"column":25},"action":"insert","lines":["g"]},{"start":{"row":205,"column":27},"end":{"row":217,"column":4},"action":"remove","lines":["[","                {","                    ptype: 'rallygridboardcustomfiltercontrol',","                    filterControlConfig: {","                        modelNames: model,","                        stateful: true,","                        stateId: this.getContext().getScopedStateId('custom-filter-grid')","                    }","                }","            ],","            gridConfig: {","                store: myStore,","    "]},{"start":{"row":205,"column":27},"end":{"row":208,"column":0},"action":"insert","lines":["true,","            defaultSortToRank: true,","            selType: \"cellmodel\",",""]},{"start":{"row":209,"column":16},"end":{"row":209,"column":19},"action":"remove","lines":["   "]},{"start":{"row":209,"column":16},"end":{"row":209,"column":17},"action":"remove","lines":[" "]},{"start":{"row":210,"column":0},"end":{"row":210,"column":4},"action":"remove","lines":["    "]},{"start":{"row":211,"column":20},"end":{"row":211,"column":23},"action":"remove","lines":["   "]},{"start":{"row":211,"column":20},"end":{"row":211,"column":21},"action":"remove","lines":[" "]},{"start":{"row":212,"column":20},"end":{"row":212,"column":24},"action":"remove","lines":["    "]},{"start":{"row":213,"column":20},"end":{"row":213,"column":22},"action":"remove","lines":["  "]},{"start":{"row":213,"column":20},"end":{"row":213,"column":22},"action":"remove","lines":["  "]},{"start":{"row":214,"column":0},"end":{"row":214,"column":4},"action":"remove","lines":["    "]},{"start":{"row":215,"column":16},"end":{"row":215,"column":20},"action":"remove","lines":["    "]},{"start":{"row":216,"column":16},"end":{"row":216,"column":20},"action":"remove","lines":["    "]},{"start":{"row":217,"column":20},"end":{"row":217,"column":21},"action":"remove","lines":[" "]},{"start":{"row":217,"column":20},"end":{"row":217,"column":23},"action":"remove","lines":["   "]},{"start":{"row":218,"column":0},"end":{"row":218,"column":4},"action":"remove","lines":["    "]},{"start":{"row":219,"column":20},"end":{"row":219,"column":24},"action":"remove","lines":["    "]},{"start":{"row":220,"column":16},"end":{"row":220,"column":20},"action":"remove","lines":["    "]},{"start":{"row":221,"column":16},"end":{"row":221,"column":17},"action":"remove","lines":[" "]},{"start":{"row":221,"column":16},"end":{"row":221,"column":19},"action":"remove","lines":["   "]},{"start":{"row":222,"column":16},"end":{"row":223,"column":4},"action":"remove","lines":["    {","    "]},{"start":{"row":222,"column":16},"end":{"row":223,"column":0},"action":"insert","lines":["{",""]},{"start":{"row":224,"column":0},"end":{"row":224,"column":4},"action":"remove","lines":["    "]},{"start":{"row":225,"column":20},"end":{"row":225,"column":24},"action":"remove","lines":["    "]},{"start":{"row":226,"column":16},"end":{"row":227,"column":0},"action":"insert","lines":["}",""]},{"start":{"row":227,"column":4},"end":{"row":228,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":227,"column":12},"end":{"row":228,"column":0},"action":"insert","lines":["],",""]},{"start":{"row":228,"column":8},"end":{"row":229,"column":0},"action":"remove","lines":["]",""]},{"start":{"row":228,"column":12},"end":{"row":228,"column":22},"action":"remove","lines":["        },"]},{"start":{"row":228,"column":12},"end":{"row":229,"column":35},"action":"insert","lines":["scope: this","        }), this.add(this._myGrid);"]},{"start":{"row":230,"column":4},"end":{"row":231,"column":0},"action":"insert","lines":["},",""]},{"start":{"row":231,"column":4},"end":{"row":232,"column":0},"action":"insert","lines":["",""]},{"start":{"row":232,"column":4},"end":{"row":234,"column":0},"action":"remove","lines":["scope: this","        }), ",""]},{"start":{"row":232,"column":4},"end":{"row":234,"column":3},"action":"insert","lines":["_updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","   "]},{"start":{"row":234,"column":11},"end":{"row":234,"column":12},"action":"insert","lines":[" "]},{"start":{"row":234,"column":17},"end":{"row":234,"column":34},"action":"remove","lines":["add(this._myGrid)"]},{"start":{"row":234,"column":17},"end":{"row":244,"column":45},"action":"insert","lines":["_createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : []"]}],[{"start":{"row":107,"column":8},"end":{"row":107,"column":63},"action":"insert","lines":["console.log(\"pi type: \",selectedType.get('TypePath') );"],"id":31,"ignore":true}],[{"start":{"row":15,"column":14},"end":{"row":69,"column":14},"action":"remove","lines":["boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        this._"],"id":32,"ignore":true},{"start":{"row":39,"column":4},"end":{"row":42,"column":0},"action":"remove","lines":["    this._boxcontainer.add(this._checkbox);","        this.add(this._boxcontainer);","    },",""]},{"start":{"row":39,"column":4},"end":{"row":40,"column":4},"action":"insert","lines":["}, //end launch","    "]},{"start":{"row":55,"column":0},"end":{"row":56,"column":4},"action":"remove","lines":["                    if (this._myGrid === undefined) {","    "]},{"start":{"row":55,"column":31},"end":{"row":55,"column":32},"action":"remove","lines":["\""]},{"start":{"row":55,"column":31},"end":{"row":55,"column":32},"action":"insert","lines":["'"]},{"start":{"row":55,"column":43},"end":{"row":55,"column":44},"action":"remove","lines":["W"]},{"start":{"row":55,"column":43},"end":{"row":55,"column":44},"action":"insert","lines":["w"]},{"start":{"row":55,"column":48},"end":{"row":56,"column":4},"action":"remove","lines":["DataStore\", {","    "]},{"start":{"row":55,"column":48},"end":{"row":56,"column":0},"action":"insert","lines":[".TreeStoreBuilder').build({",""]},{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"remove","lines":["    "]},{"start":{"row":58,"column":24},"end":{"row":60,"column":7},"action":"remove","lines":["    filters: this._getReleaseFilter(),","                            remoteSort: false,","       "]},{"start":{"row":58,"column":24},"end":{"row":59,"column":0},"action":"insert","lines":["enableHierarchy: false",""]},{"start":{"row":59,"column":20},"end":{"row":59,"column":32},"action":"remove","lines":[" listeners: "]},{"start":{"row":59,"column":20},"end":{"row":59,"column":28},"action":"insert","lines":["}).then("]},{"start":{"row":60,"column":24},"end":{"row":61,"column":66},"action":"remove","lines":["        load: function(store, records, success) {","                                    this._calculateScore(records);"]},{"start":{"row":60,"column":24},"end":{"row":61,"column":35},"action":"insert","lines":["success: this._onStoreBuilt,","                        scope: this"]},{"start":{"row":62,"column":20},"end":{"row":64,"column":0},"action":"insert","lines":["});","",""]},{"start":{"row":64,"column":16},"end":{"row":64,"column":40},"action":"remove","lines":["this._updateGrid(store);"]},{"start":{"row":64,"column":16},"end":{"row":64,"column":18},"action":"insert","lines":["},"]},{"start":{"row":65,"column":16},"end":{"row":65,"column":20},"action":"remove","lines":["    "]},{"start":{"row":65,"column":16},"end":{"row":66,"column":0},"action":"insert","lines":["scope: this",""]},{"start":{"row":66,"column":13},"end":{"row":66,"column":14},"action":"remove","lines":[","]},{"start":{"row":66,"column":13},"end":{"row":66,"column":15},"action":"insert","lines":[");"]},{"start":{"row":67,"column":8},"end":{"row":68,"column":0},"action":"insert","lines":["}",""]},{"start":{"row":68,"column":4},"end":{"row":74,"column":83},"action":"remove","lines":["                    update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },","                                scope: this","                            },","                            fetch: [\"Name\", \"FormattedID\", \"Release\", ","                                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\""]},{"start":{"row":68,"column":4},"end":{"row":79,"column":27},"action":"insert","lines":["},","    ","        _onStoreBuilt: function(store) {","        console.log(\"store: \", store);","        var model = store.getModel(),","            context = this.getContext();","        this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: model,","            toggleState: 'grid',","            stateful: false"]},{"start":{"row":80,"column":12},"end":{"row":81,"column":0},"action":"insert","lines":["plugins: [",""]},{"start":{"row":81,"column":16},"end":{"row":81,"column":43},"action":"remove","lines":["    \"WSJFScore\", \"JobSize\"]"]},{"start":{"row":81,"column":16},"end":{"row":81,"column":39},"action":"insert","lines":["'rallygridboardaddnew',"]},{"start":{"row":82,"column":16},"end":{"row":83,"column":0},"action":"insert","lines":["{",""]},{"start":{"row":83,"column":8},"end":{"row":84,"column":0},"action":"remove","lines":["});",""]},{"start":{"row":83,"column":20},"end":{"row":85,"column":53},"action":"remove","lines":["        }","                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithM"]},{"start":{"row":83,"column":20},"end":{"row":85,"column":21},"action":"insert","lines":["ptype: 'rallygridboardcustomfiltercontrol',","                    headerPosition: 'left',","                    m"]},{"start":{"row":85,"column":25},"end":{"row":85,"column":26},"action":"remove","lines":["("]},{"start":{"row":85,"column":25},"end":{"row":85,"column":27},"action":"insert","lines":[": "]},{"start":{"row":85,"column":32},"end":{"row":85,"column":34},"action":"remove","lines":[");"]},{"start":{"row":85,"column":32},"end":{"row":85,"column":33},"action":"insert","lines":[","]},{"start":{"row":86,"column":20},"end":{"row":86,"column":24},"action":"remove","lines":["    "]},{"start":{"row":86,"column":20},"end":{"row":86,"column":35},"action":"insert","lines":["stateful: true,"]},{"start":{"row":87,"column":20},"end":{"row":89,"column":12},"action":"remove","lines":["    // clear and re-apply filter since reconfiguring model ","                        // doesn't do this","            "]},{"start":{"row":87,"column":20},"end":{"row":91,"column":0},"action":"insert","lines":["stateId: context.getScopedStateId('columns-example')","                }","            ],","            gridConfig: {",""]},{"start":{"row":91,"column":12},"end":{"row":91,"column":15},"action":"remove","lines":["var"]},{"start":{"row":91,"column":12},"end":{"row":91,"column":15},"action":"insert","lines":["   "]},{"start":{"row":91,"column":21},"end":{"row":91,"column":41},"action":"remove","lines":[" = this._myGrid.getS"]},{"start":{"row":91,"column":21},"end":{"row":91,"column":24},"action":"insert","lines":[": s"]},{"start":{"row":91,"column":28},"end":{"row":91,"column":31},"action":"remove","lines":["();"]},{"start":{"row":91,"column":28},"end":{"row":91,"column":29},"action":"insert","lines":[","]},{"start":{"row":92,"column":16},"end":{"row":93,"column":66},"action":"remove","lines":["         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();"]},{"start":{"row":92,"column":16},"end":{"row":94,"column":45},"action":"insert","lines":["columnCfgs: [","                    {","                        text: \"Portfolio ID\","]},{"start":{"row":95,"column":20},"end":{"row":96,"column":0},"action":"remove","lines":["",""]},{"start":{"row":95,"column":24},"end":{"row":95,"column":85},"action":"remove","lines":["                        store.clearFilter(filter.length > 0);"]},{"start":{"row":95,"column":24},"end":{"row":96,"column":32},"action":"insert","lines":["dataIndex: \"FormattedID\",","                        flex: 1,"]},{"start":{"row":97,"column":24},"end":{"row":97,"column":47},"action":"remove","lines":["    if(filter.length) {"]},{"start":{"row":97,"column":24},"end":{"row":97,"column":48},"action":"insert","lines":["xtype: \"templatecolumn\","]},{"start":{"row":98,"column":24},"end":{"row":98,"column":69},"action":"remove","lines":["      store.filter(this._getReleaseFilter());"]},{"start":{"row":98,"column":24},"end":{"row":98,"column":89},"action":"insert","lines":["tpl: Ext.create(\"Rally.ui.renderer.template.FormattedIDTemplate\")"]},{"start":{"row":99,"column":20},"end":{"row":99,"column":21},"action":"remove","lines":[" "]},{"start":{"row":99,"column":20},"end":{"row":100,"column":0},"action":"insert","lines":["}, ",""]},{"start":{"row":100,"column":7},"end":{"row":101,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":100,"column":20},"end":{"row":100,"column":32},"action":"remove","lines":["           }"]},{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"insert","lines":["{"]},{"start":{"row":101,"column":23},"end":{"row":101,"column":37},"action":"insert","lines":[" text: \"Name\","]},{"start":{"row":102,"column":24},"end":{"row":103,"column":0},"action":"remove","lines":["// re-apply grid update listeners",""]},{"start":{"row":102,"column":24},"end":{"row":103,"column":12},"action":"insert","lines":["dataIndex: \"Name\",","            "]},{"start":{"row":103,"column":24},"end":{"row":103,"column":25},"action":"remove","lines":[" "]},{"start":{"row":103,"column":24},"end":{"row":104,"column":0},"action":"insert","lines":["flex: 2",""]},{"start":{"row":104,"column":11},"end":{"row":104,"column":27},"action":"remove","lines":["var that = this;"]},{"start":{"row":104,"column":11},"end":{"row":104,"column":23},"action":"insert","lines":["         }, "]},{"start":{"row":105,"column":20},"end":{"row":105,"column":90},"action":"remove","lines":["    store.addListener('update', function(store, rec, modified, opts) {"]},{"start":{"row":105,"column":20},"end":{"row":105,"column":84},"action":"insert","lines":["\"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\", \"JobSize\", "]},{"start":{"row":106,"column":20},"end":{"row":107,"column":0},"action":"insert","lines":["{",""]},{"start":{"row":107,"column":8},"end":{"row":111,"column":27},"action":"remove","lines":["that._calculateScore([rec]);","                        });","                        store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });"]},{"start":{"row":107,"column":8},"end":{"row":109,"column":36},"action":"insert","lines":["                text: \"WSJF Score\",","                        dataIndex: \"WSJFScore\",","                        editor: null"]},{"start":{"row":111,"column":16},"end":{"row":112,"column":12},"action":"insert","lines":["]","            "]},{"start":{"row":113,"column":12},"end":{"row":115,"column":9},"action":"remove","lines":["    scope: this","            });","        }"]},{"start":{"row":113,"column":12},"end":{"row":114,"column":11},"action":"insert","lines":["height: this.getHeight()","        });"]},{"start":{"row":195,"column":4},"end":{"row":200,"column":5},"action":"remove","lines":["","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : [];","    }"]}],[{"start":{"row":24,"column":0},"end":{"row":24,"column":55},"action":"remove","lines":["        this._boxcontainer.add(this._piCombobox); //new"],"id":33,"ignore":true}],[{"start":{"row":194,"column":5},"end":{"row":195,"column":4},"action":"remove","lines":[",","    "],"id":34,"ignore":true}],[{"start":{"row":44,"column":4},"end":{"row":51,"column":0},"action":"remove","lines":["        if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }",""],"id":35,"ignore":true},{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"remove","lines":["    "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":65,"column":26},"end":{"row":65,"column":30},"action":"remove","lines":["getM"],"id":36,"ignore":true},{"start":{"row":65,"column":26},"end":{"row":65,"column":27},"action":"insert","lines":["m"]},{"start":{"row":65,"column":31},"end":{"row":65,"column":33},"action":"remove","lines":["()"]}],[{"start":{"row":45,"column":11},"end":{"row":45,"column":25},"action":"insert","lines":[" this._model ="],"id":37,"ignore":true},{"start":{"row":60,"column":0},"end":{"row":61,"column":0},"action":"insert","lines":["            console.log(\"model: \", this._model);",""]}],[{"start":{"row":43,"column":31},"end":{"row":43,"column":60},"action":"remove","lines":["this._piCombobox.getRecord();"],"id":38,"ignore":true},{"start":{"row":66,"column":20},"end":{"row":66,"column":32},"action":"remove","lines":["store.model,"]},{"start":{"row":66,"column":20},"end":{"row":66,"column":49},"action":"insert","lines":["this._piCombobox.getRecord();"]},{"start":{"row":67,"column":8},"end":{"row":67,"column":12},"action":"insert","lines":["var "]}],[{"start":{"row":56,"column":0},"end":{"row":57,"column":0},"action":"remove","lines":["",""],"id":39,"ignore":true},{"start":{"row":180,"column":0},"end":{"row":188,"column":0},"action":"remove","lines":["    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    }",""]}],[{"start":{"row":45,"column":11},"end":{"row":45,"column":25},"action":"remove","lines":[" this._model ="],"id":40,"ignore":true},{"start":{"row":178,"column":5},"end":{"row":179,"column":4},"action":"remove","lines":[",","    "]}],[{"start":{"row":42,"column":0},"end":{"row":43,"column":0},"action":"insert","lines":["        console.log(\"onPICombobox\");",""],"id":41,"ignore":true},{"start":{"row":44,"column":31},"end":{"row":44,"column":60},"action":"insert","lines":["this._piCombobox.getRecord();"]}],[{"start":{"row":60,"column":0},"end":{"row":61,"column":0},"action":"remove","lines":["            console.log(\"model: \", this._model);",""],"id":42,"ignore":true},{"start":{"row":65,"column":48},"end":{"row":65,"column":64},"action":"insert","lines":[".get('TypePath')"]}],[{"start":{"row":66,"column":0},"end":{"row":67,"column":0},"action":"insert","lines":["        console.log(\"model: \", model);",""],"id":43,"ignore":true}],[{"start":{"row":71,"column":17},"end":{"row":71,"column":22},"action":"remove","lines":["Names"],"id":44,"ignore":true}],[{"start":{"row":49,"column":0},"end":{"row":50,"column":0},"action":"insert","lines":["                    console.log(\"Model for store: \", model);",""],"id":45,"ignore":true}],[{"start":{"row":72,"column":17},"end":{"row":72,"column":22},"action":"insert","lines":["Names"],"id":46,"ignore":true},{"start":{"row":80,"column":25},"end":{"row":80,"column":30},"action":"insert","lines":["Names"]}],[{"start":{"row":46,"column":11},"end":{"row":46,"column":12},"action":"insert","lines":["/"],"id":47}],[{"start":{"row":46,"column":12},"end":{"row":46,"column":13},"action":"insert","lines":["*"],"id":48}],[{"start":{"row":60,"column":15},"end":{"row":60,"column":16},"action":"insert","lines":[" "],"id":49}],[{"start":{"row":60,"column":16},"end":{"row":60,"column":17},"action":"insert","lines":["*"],"id":50}],[{"start":{"row":60,"column":17},"end":{"row":60,"column":18},"action":"insert","lines":["/"],"id":51}],[{"start":{"row":60,"column":18},"end":{"row":61,"column":0},"action":"insert","lines":["",""],"id":52},{"start":{"row":61,"column":0},"end":{"row":61,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":61,"column":12},"end":{"row":68,"column":15},"action":"insert","lines":["Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                model: ['PortfolioItem/Feature'],","                autoLoad: true,","                enableHierarchy: false","            }).then({","                success: this._onStoreBuilt,","                scope: this","            });"],"id":57}],[{"start":{"row":62,"column":23},"end":{"row":62,"column":48},"action":"remove","lines":["['PortfolioItem/Feature']"],"id":58},{"start":{"row":62,"column":23},"end":{"row":62,"column":51},"action":"insert","lines":["selectedType.get('TypePath')"]}],[{"start":{"row":46,"column":11},"end":{"row":46,"column":13},"action":"remove","lines":["/*"],"id":59,"ignore":true},{"start":{"row":60,"column":0},"end":{"row":68,"column":0},"action":"remove","lines":["            }); */","            Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","                model: selectedType.get('TypePath'),","                autoLoad: true,","                enableHierarchy: false","            }).then({","                success: this._onStoreBuilt,","                scope: this",""]}],[{"start":{"row":46,"column":0},"end":{"row":50,"column":8},"action":"remove","lines":["            Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),","                success: function(model){","                    console.log(\"Model for store: \", model);","        "],"id":60,"ignore":true},{"start":{"row":47,"column":16},"end":{"row":48,"column":8},"action":"remove","lines":["        model: model,","        "]},{"start":{"row":47,"column":16},"end":{"row":48,"column":0},"action":"insert","lines":["model: selectedType.get('TypePath'),",""]},{"start":{"row":49,"column":16},"end":{"row":49,"column":24},"action":"remove","lines":["        "]},{"start":{"row":50,"column":12},"end":{"row":50,"column":18},"action":"remove","lines":["      "]},{"start":{"row":50,"column":12},"end":{"row":50,"column":14},"action":"remove","lines":["  "]},{"start":{"row":51,"column":0},"end":{"row":51,"column":8},"action":"remove","lines":["        "]},{"start":{"row":52,"column":0},"end":{"row":55,"column":0},"action":"remove","lines":["                        scope: this","                    });","                },",""]}],[{"start":{"row":47,"column":23},"end":{"row":47,"column":51},"action":"remove","lines":["selectedType.get('TypePath')"],"id":61,"ignore":true},{"start":{"row":47,"column":23},"end":{"row":47,"column":48},"action":"insert","lines":["['PortfolioItem/Feature']"]}],[{"start":{"row":42,"column":33},"end":{"row":42,"column":34},"action":"remove","lines":["\""],"id":62,"ignore":true},{"start":{"row":42,"column":33},"end":{"row":42,"column":54},"action":"insert","lines":[": \", this._piCombobox"]}],[{"start":{"row":15,"column":14},"end":{"row":69,"column":14},"action":"insert","lines":["boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        this._"],"id":63,"ignore":true},{"start":{"row":78,"column":0},"end":{"row":78,"column":55},"action":"insert","lines":["        this._boxcontainer.add(this._piCombobox); //new"]},{"start":{"row":93,"column":4},"end":{"row":97,"column":0},"action":"remove","lines":["}, //end launch","    ","    _onPICombobox: function() {","        console.log(\"onPICombobox: \", this._piCombobox);",""]},{"start":{"row":93,"column":4},"end":{"row":100,"column":3},"action":"insert","lines":["    this._boxcontainer.add(this._checkbox);","        this.add(this._boxcontainer);","    },","","    _onPICombobox: function() {","        if( this._piCombobox ) {","            var selectedType = this._piCombobox.getRecord();","   "]},{"start":{"row":100,"column":11},"end":{"row":100,"column":12},"action":"insert","lines":[" "]},{"start":{"row":100,"column":14},"end":{"row":100,"column":15},"action":"remove","lines":["("]},{"start":{"row":100,"column":15},"end":{"row":100,"column":16},"action":"insert","lines":["("]},{"start":{"row":100,"column":32},"end":{"row":102,"column":27},"action":"remove","lines":[" ) {","            var selectedType = this._piCombobox.getRecord();","            console.log(\"pi"]},{"start":{"row":100,"column":32},"end":{"row":109,"column":15},"action":"insert","lines":[".getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }","        ","            Rally.data.ModelFactory.getModel({","               "]},{"start":{"row":109,"column":22},"end":{"row":109,"column":24},"action":"remove","lines":["\","]},{"start":{"row":109,"column":50},"end":{"row":110,"column":0},"action":"remove","lines":[" );",""]},{"start":{"row":109,"column":50},"end":{"row":112,"column":12},"action":"insert","lines":[",","                success: function(model){","                    if (this._myGrid === undefined) {","            "]},{"start":{"row":112,"column":35},"end":{"row":112,"column":36},"action":"remove","lines":["'"]},{"start":{"row":112,"column":35},"end":{"row":112,"column":36},"action":"insert","lines":["\""]},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"remove","lines":["w"]},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"insert","lines":["W"]},{"start":{"row":112,"column":52},"end":{"row":114,"column":0},"action":"remove","lines":[".TreeStoreBuilder').build({","                model: ['PortfolioItem/Feature'],",""]},{"start":{"row":112,"column":52},"end":{"row":114,"column":12},"action":"insert","lines":["DataStore\", {","                            model: model,","            "]},{"start":{"row":115,"column":16},"end":{"row":115,"column":38},"action":"remove","lines":["enableHierarchy: false"]},{"start":{"row":115,"column":16},"end":{"row":115,"column":62},"action":"insert","lines":["            filters: this._getReleaseFilter(),"]},{"start":{"row":116,"column":12},"end":{"row":117,"column":0},"action":"remove","lines":["}).then({",""]},{"start":{"row":116,"column":28},"end":{"row":117,"column":0},"action":"remove","lines":["success: this._onStoreBuilt,",""]},{"start":{"row":116,"column":28},"end":{"row":117,"column":11},"action":"insert","lines":["remoteSort: false,","           "]},{"start":{"row":117,"column":27},"end":{"row":117,"column":38},"action":"remove","lines":["scope: this"]},{"start":{"row":117,"column":27},"end":{"row":117,"column":40},"action":"insert","lines":[" listeners: {"]},{"start":{"row":118,"column":12},"end":{"row":119,"column":0},"action":"remove","lines":["});",""]},{"start":{"row":118,"column":20},"end":{"row":119,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":118,"column":24},"end":{"row":119,"column":0},"action":"remove","lines":["},",""]},{"start":{"row":118,"column":28},"end":{"row":119,"column":0},"action":"remove","lines":["",""]},{"start":{"row":118,"column":32},"end":{"row":118,"column":45},"action":"remove","lines":["_onStoreBuilt"]},{"start":{"row":118,"column":32},"end":{"row":118,"column":36},"action":"insert","lines":["load"]},{"start":{"row":118,"column":52},"end":{"row":128,"column":27},"action":"remove","lines":[") {","        console.log(\"store: \", store);","        var model = this._piCombobox.getRecord().get('TypePath');","        console.log(\"model: \", model);","        var context = this.getContext();","        this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: model,","            toggleState: 'grid',","            stateful: false"]},{"start":{"row":118,"column":52},"end":{"row":128,"column":83},"action":"insert","lines":[", records, success) {","                                    this._calculateScore(records);","                                    this._updateGrid(store);","                                },","                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },","                                scope: this","                            },","                            fetch: [\"Name\", \"FormattedID\", \"Release\", ","                                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\""]},{"start":{"row":129,"column":12},"end":{"row":130,"column":0},"action":"remove","lines":["plugins: [",""]},{"start":{"row":129,"column":12},"end":{"row":129,"column":16},"action":"insert","lines":["    "]},{"start":{"row":129,"column":32},"end":{"row":130,"column":0},"action":"remove","lines":["'rallygridboardaddnew',",""]},{"start":{"row":129,"column":32},"end":{"row":130,"column":5},"action":"insert","lines":["\"WSJFScore\", \"JobSize\"]","     "]},{"start":{"row":130,"column":21},"end":{"row":130,"column":22},"action":"remove","lines":["{"]},{"start":{"row":130,"column":21},"end":{"row":130,"column":27},"action":"insert","lines":["   });"]},{"start":{"row":131,"column":20},"end":{"row":133,"column":32},"action":"remove","lines":["ptype: 'rallygridboardcustomfiltercontrol',","                    headerPosition: 'left',","                    modelNames: "]},{"start":{"row":131,"column":20},"end":{"row":133,"column":58},"action":"insert","lines":["}","                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel("]},{"start":{"row":133,"column":63},"end":{"row":133,"column":64},"action":"remove","lines":[","]},{"start":{"row":133,"column":63},"end":{"row":133,"column":65},"action":"insert","lines":[");"]},{"start":{"row":134,"column":20},"end":{"row":134,"column":35},"action":"remove","lines":["stateful: true,"]},{"start":{"row":134,"column":20},"end":{"row":134,"column":24},"action":"insert","lines":["    "]},{"start":{"row":135,"column":20},"end":{"row":135,"column":72},"action":"remove","lines":["stateId: context.getScopedStateId('columns-example')"]},{"start":{"row":135,"column":20},"end":{"row":135,"column":79},"action":"insert","lines":["    // clear and re-apply filter since reconfiguring model "]},{"start":{"row":136,"column":16},"end":{"row":137,"column":0},"action":"remove","lines":["}",""]},{"start":{"row":136,"column":24},"end":{"row":138,"column":0},"action":"remove","lines":["    ],","            gridConfig: {",""]},{"start":{"row":136,"column":24},"end":{"row":137,"column":9},"action":"insert","lines":["// doesn't do this","         "]},{"start":{"row":137,"column":24},"end":{"row":137,"column":27},"action":"insert","lines":["var"]},{"start":{"row":137,"column":33},"end":{"row":137,"column":36},"action":"remove","lines":[": s"]},{"start":{"row":137,"column":33},"end":{"row":137,"column":53},"action":"insert","lines":[" = this._myGrid.getS"]},{"start":{"row":137,"column":57},"end":{"row":137,"column":58},"action":"remove","lines":[","]},{"start":{"row":137,"column":57},"end":{"row":137,"column":60},"action":"insert","lines":["();"]},{"start":{"row":138,"column":16},"end":{"row":140,"column":45},"action":"remove","lines":["columnCfgs: [","                    {","                        text: \"Portfolio ID\","]},{"start":{"row":138,"column":16},"end":{"row":139,"column":66},"action":"insert","lines":["         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();"]},{"start":{"row":140,"column":20},"end":{"row":141,"column":0},"action":"insert","lines":["",""]},{"start":{"row":141,"column":4},"end":{"row":142,"column":32},"action":"remove","lines":["dataIndex: \"FormattedID\",","                        flex: 1,"]},{"start":{"row":141,"column":4},"end":{"row":141,"column":65},"action":"insert","lines":["                        store.clearFilter(filter.length > 0);"]},{"start":{"row":142,"column":24},"end":{"row":142,"column":48},"action":"remove","lines":["xtype: \"templatecolumn\","]},{"start":{"row":142,"column":24},"end":{"row":142,"column":47},"action":"insert","lines":["    if(filter.length) {"]},{"start":{"row":143,"column":24},"end":{"row":143,"column":89},"action":"remove","lines":["tpl: Ext.create(\"Rally.ui.renderer.template.FormattedIDTemplate\")"]},{"start":{"row":143,"column":24},"end":{"row":143,"column":69},"action":"insert","lines":["      store.filter(this._getReleaseFilter());"]},{"start":{"row":144,"column":20},"end":{"row":144,"column":23},"action":"remove","lines":["}, "]},{"start":{"row":144,"column":20},"end":{"row":144,"column":29},"action":"insert","lines":["        }"]},{"start":{"row":145,"column":13},"end":{"row":146,"column":0},"action":"remove","lines":["       {",""]},{"start":{"row":145,"column":24},"end":{"row":146,"column":0},"action":"insert","lines":["}",""]},{"start":{"row":146,"column":13},"end":{"row":147,"column":0},"action":"remove","lines":["text: \"Name\",",""]},{"start":{"row":146,"column":13},"end":{"row":146,"column":14},"action":"insert","lines":[" "]},{"start":{"row":146,"column":23},"end":{"row":147,"column":0},"action":"insert","lines":["",""]},{"start":{"row":147,"column":15},"end":{"row":148,"column":12},"action":"remove","lines":["dataIndex: \"Name\",","            "]},{"start":{"row":147,"column":15},"end":{"row":148,"column":0},"action":"insert","lines":["         // re-apply grid update listeners",""]},{"start":{"row":148,"column":12},"end":{"row":149,"column":0},"action":"remove","lines":["flex: 2",""]},{"start":{"row":148,"column":24},"end":{"row":148,"column":26},"action":"remove","lines":["  "]},{"start":{"row":148,"column":24},"end":{"row":149,"column":0},"action":"insert","lines":["var that = this;",""]},{"start":{"row":149,"column":6},"end":{"row":150,"column":0},"action":"remove","lines":["}, ",""]},{"start":{"row":149,"column":6},"end":{"row":149,"column":7},"action":"insert","lines":[" "]},{"start":{"row":149,"column":24},"end":{"row":150,"column":0},"action":"remove","lines":["   \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\", \"JobSize\", ",""]},{"start":{"row":149,"column":24},"end":{"row":150,"column":5},"action":"insert","lines":["store.addListener('update', function(store, rec, modified, opts) {","     "]},{"start":{"row":150,"column":25},"end":{"row":151,"column":0},"action":"remove","lines":["{",""]},{"start":{"row":150,"column":27},"end":{"row":151,"column":0},"action":"insert","lines":[" that._calculateScore([rec]);",""]},{"start":{"row":151,"column":22},"end":{"row":151,"column":41},"action":"remove","lines":["text: \"WSJF Score\","]},{"start":{"row":151,"column":22},"end":{"row":151,"column":27},"action":"insert","lines":["  });"]},{"start":{"row":152,"column":24},"end":{"row":153,"column":36},"action":"remove","lines":["dataIndex: \"WSJFScore\",","                        editor: null"]},{"start":{"row":152,"column":24},"end":{"row":154,"column":27},"action":"insert","lines":["store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });"]},{"start":{"row":156,"column":4},"end":{"row":157,"column":0},"action":"remove","lines":["            ]",""]},{"start":{"row":157,"column":12},"end":{"row":158,"column":0},"action":"remove","lines":["height: this.getHeight()",""]},{"start":{"row":157,"column":12},"end":{"row":158,"column":4},"action":"insert","lines":["    scope: this","    "]},{"start":{"row":159,"column":0},"end":{"row":160,"column":0},"action":"insert","lines":["        }",""]},{"start":{"row":229,"column":34},"end":{"row":244,"column":45},"action":"insert","lines":[";","    },","    ","    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : []"]}],[{"start":{"row":5,"column":67},"end":{"row":6,"column":113},"action":"insert","lines":["","    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/async/1.22/async.min.js\"></script>"],"id":64,"ignore":true},{"start":{"row":94,"column":8},"end":{"row":94,"column":45},"action":"remove","lines":["this._boxcontainer.add(this._checkbox"]},{"start":{"row":94,"column":8},"end":{"row":107,"column":45},"action":"insert","lines":[" this._myButton = this.add({","            xtype : 'rallybutton',","            height : 20,","            text : 'Export to CSV',","            listeners : {","                scope :this,","                click : function() {","                    var exporter = Ext.create(\"GridExporter\",{});","                    exporter.exportGrid(app._myGrid);","                }","            }","        });","        this._boxcontainer.add(this._checkbox);","        this._boxcontainer.add(this._myButton"]},{"start":{"row":262,"column":0},"end":{"row":390,"column":0},"action":"insert","lines":["                Ext.define(\"GridExporter\", {","    dateFormat : 'Y-m-d g:i',","","    exportGrid: function(grid) {","        if (Ext.isIE) {","            this._ieToExcel(grid);","        } else {","            var data = this._getCSV(grid);","            window.location = 'data:text/csv;charset=utf8,' + encodeURIComponent(data);","        }","    },","","    _escapeForCSV: function(string) {","        if (string.match(/,/)) {","            if (!string.match(/\"/)) {","                string = '\"' + string + '\"';","            } else {","                string = string.replace(/,/g, ''); // comma's and quotes-- sorry, just lose the commas","            }","        }","        return string;","    },","","    _getFieldText: function(fieldData) {","        var text;","","        if (fieldData === null || fieldData === undefined) {","            text = '';","            ","        } else if (fieldData._refObjectName && !fieldData.getMonth) {","            text = fieldData._refObjectName;","","        } else if (fieldData instanceof Date) {","            text = Ext.Date.format(fieldData, this.dateFormat);","","        } else if (!fieldData.match) { // not a string or object we recognize...bank it out","            text = '';","","        } else {","            text = fieldData;","        }","","        return text;","    },","","    _getFieldTextAndEscape: function(fieldData) {","        var string  = this._getFieldText(fieldData);","        return this._escapeForCSV(string);","    },","","    _getCSV: function (grid) {","        var cols    = grid.columns;","        var store   = grid.store;","        var data    = '';","","        var that = this;","        Ext.Array.each(cols, function(col, index) {","            if (col.hidden !== true) {","                data += that._getFieldTextAndEscape(col.text) + ',';","            }","        });","        data += \"\\n\";","","        store.each(function(record) {","            var entry       = record.getData();","            Ext.Array.each(cols, function(col, index) {","                if (col.hidden !== true) {","                    var fieldName   = col.dataIndex;","                    var text        = entry[fieldName];","","                    data += that._getFieldTextAndEscape(text) + ',';","                }","            });","            data += \"\\n\";","        });","","        return data;","    },","","    _ieGetGridData : function(grid, sheet) {","        var that            = this;","        var resourceItems   = grid.store.data.items;","        var cols            = grid.columns;","","        Ext.Array.each(cols, function(col, colIndex) {","            if (col.hidden !== true) {","                console.log('header: ', col.text);","                sheet.cells(1,colIndex + 1).value = col.text;","            }","        });","","        var rowIndex = 2;","        grid.store.each(function(record) {","            var entry   = record.getData();","","            Ext.Array.each(cols, function(col, colIndex) {","                if (col.hidden !== true) {","                    var fieldName   = col.dataIndex;","                    var text        = entry[fieldName];","                    var value       = that._getFieldText(text);","","                    sheet.cells(rowIndex, colIndex+1).value = value;","                }","            });","            rowIndex++;","        });","    },","","    _ieToExcel: function (grid) {","        if (window.ActiveXObject){","            var  xlApp, xlBook;","            try {","                xlApp = new ActiveXObject(\"Excel.Application\"); ","                xlBook = xlApp.Workbooks.Add();","            } catch (e) {","                Ext.Msg.alert('Error', 'For the export to work in IE, you have to enable a security setting called \"Initialize and script ActiveX control not marked as safe\" from Internet Options -> Security -> Custom level...\"');","                return;","            }","","            xlBook.worksheets(\"Sheet1\").activate();","            var XlSheet = xlBook.activeSheet;","            xlApp.visible = true; ","","           this._ieGetGridData(grid, XlSheet);","           XlSheet.columns.autofit(); ","        }","    }","});",""]}],[{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"insert","lines":["var app = null;",""],"id":65,"ignore":true},{"start":{"row":14,"column":0},"end":{"row":18,"column":0},"action":"insert","lines":["    uses: [","        'Ext.ux.exporter.Exporter'","    ],","",""]}],[{"start":{"row":75,"column":0},"end":{"row":76,"column":0},"action":"insert","lines":["        var app = this;",""],"id":66,"ignore":true}],[{"start":{"row":5,"column":67},"end":{"row":6,"column":113},"action":"remove","lines":["","    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/async/1.22/async.min.js\"></script>"],"id":67,"ignore":true},{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"remove","lines":["var app = null;",""]},{"start":{"row":12,"column":4},"end":{"row":390,"column":38},"action":"remove","lines":["uses: [","        'Ext.ux.exporter.Exporter'","    ],","","    componentCls: 'app',","    //items:{ html:'<a href=\"https://help.rallydev.com/apps/2.0/doc/\">App SDK 2.0 Docs</a>'},","    launch: function() {","        this._boxcontainer = Ext.create('Ext.form.Panel', {","            title: 'Grid Filters',","            layout: { type: 'hbox'},","            width: '95%',","            bodyPadding: 10","        });","        ","        this._releaseCombobox = this.add({","            xtype: 'rallyreleasecombobox',","            stateful: true,","            padding: 5,","            stateId: this.getContext().getScopedStateId('release'),","            allowNoEntry: true,","            noEntryValue: '/release/-1',","            clearText: '-- Ignore Release Filter --',","            allowClear: true,","            emptyText: 'Filter by release...',","            context: this.getContext(),","            defaultToCurrentTimebox: false,","            defaultSelectionPosition: null,","            listeners: {","                ready: this._onReleaseAvailable,","                select: this._onReleaseChanged,","                scope: this","            }","        });","    }, //end launch","    ","    _onReleaseAvailable: function(combo) {","        combo.getStore().getAt(0).set('formattedName', '-- Ignore Release Filter --');","        this._boxcontainer.add(this._releaseCombobox); //new","        this._addPICombobox();","    },","    ","    _onReleaseChanged: function() {","        // if we don't yet have a PI combo box or if this is anything other than","        // the lowest level PI, bail","        if ( this._piCombobox ) {","            console.log(\"resetting filter\");","            if (this._piCombobox.getRecord().get('Ordinal') === 0)","            {","                var grid = this.down('rallygrid'),","                store = grid.getStore(),","                filter = this._getReleaseFilter();","        ","                store.clearFilter(filter.length > 0);","                if(filter.length) {","                  store.filter(this._getReleaseFilter());","                }","            }","        }","    },","    ","    _addPICombobox: function() {","        var app = this;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","        this._boxcontainer.add(this._piCombobox); //new","        this._checkbox = this.add({","            xtype: 'rallycheckboxfield',","            fieldLabel: 'Show Values After the Decimal',","            labelWidth: 200,","            padding: '5, 5, 5, 10',","            stateful: true,","            stateId: this.getContext().getScopedStateId('mycheckbox'),","            stateEvents: ['change'],","            value: false,","            listeners: {","                change: this._onPICombobox,","                scope: this","            }","        });","         this._myButton = this.add({","            xtype : 'rallybutton',","            height : 20,","            text : 'Export to CSV',","            listeners : {","                scope :this,","                click : function() {","                    var exporter = Ext.create(\"GridExporter\",{});","                    exporter.exportGrid(app._myGrid);","                }","            }","        });","        this._boxcontainer.add(this._checkbox);","        this._boxcontainer.add(this._myButton);","        this.add(this._boxcontainer);","    },","","    _onPICombobox: function() {","        if( this._piCombobox ) {","            var selectedType = this._piCombobox.getRecord();","            if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                // Only use the release filter if the PI is the lowest level","                // and then ensure it is enabled","                this._releaseCombobox.enable();","            } else { // disable the ReleaseComboBox if Feature not selected","               this._releaseCombobox.disable();","            }","        ","            Rally.data.ModelFactory.getModel({","                type: selectedType.get('TypePath'),","                success: function(model){","                    if (this._myGrid === undefined) {","                        Ext.create(\"Rally.data.WsapiDataStore\", {","                            model: model,","                            autoLoad: true,","                            filters: this._getReleaseFilter(),","                            remoteSort: false,","                            listeners: {","                                load: function(store, records, success) {","                                    this._calculateScore(records);","                                    this._updateGrid(store);","                                },","                                update: function(store, rec, modified, opts) {","                                    this._calculateScore([rec]);","                                },","                                scope: this","                            },","                            fetch: [\"Name\", \"FormattedID\", \"Release\", ","                                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\",","                                \"WSJFScore\", \"JobSize\"]","                        });","                    }","                    else { // grid exists, reset the model to the correct PI type","                        this._myGrid.reconfigureWithModel(model);","                        ","                        // clear and re-apply filter since reconfiguring model ","                        // doesn't do this","                        var store = this._myGrid.getStore();","                         if (this._piCombobox.getRecord().get('Ordinal') === 0) {","                            var filter = this._getReleaseFilter();","                    ","                            store.clearFilter(filter.length > 0);","                            if(filter.length) {","                              store.filter(this._getReleaseFilter());","                            }","                        }","                       ","                        // re-apply grid update listeners","                        var that = this;","                        store.addListener('update', function(store, rec, modified, opts) {","                            that._calculateScore([rec]);","                        });","                        store.addListener('load', function(store, records, modified, opts) {","                            that._calculateScore(records); that._updateGrid(store);","                        });","                    }","                },","                scope: this","            });","        }","    },","    ","    _calculateScore: function(records) {","        var that = this;","        Ext.Array.each(records, function(feature) {","            //console.log(\"feature\", feature.data);","            var jobSize = feature.data.JobSize;","            var timeValue = feature.data.TimeCriticality;","            var OERR = feature.data.RROEValue;","            var userValue = feature.data.UserBusinessValue;","            var oldScore = feature.data.WSJFScore;","            var isChecked = false;","            if( that._checkbox) {","                isChecked = that._checkbox.getValue();","            }","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = Math.floor(((userValue + timeValue + OERR ) / jobSize) + 0.5);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) / jobSize) * 100)/100;","                }","","                if (oldScore !== score) { // only update if score changed","                    feature.set('WSJFScore', score); // set score value in db","                }","            }","        });","    },","    ","    _createGrid: function(myStore) {","        this._myGrid = Ext.create(\"Rally.ui.grid.Grid\", {","            xtype: \"rallygrid\",","            title: \"Feature Scoring Grid\",","            showPagingToolbar: true,","            pagingToolbarCfg: {","               pageSizes: [50, 100, 200, 500, 1000]","            },","            height: \"98%\",","            width: \"98%\",","            store: myStore,","            enableBulkEdit: true,","            enableRanking: true,","            defaultSortToRank: true,","            selType: \"cellmodel\",","            columnCfgs: [","                {","                    text: \"Portfolio ID\",","                    dataIndex: \"FormattedID\",","                    flex: 1,","                    xtype: \"templatecolumn\",","                    tpl: Ext.create(\"Rally.ui.renderer.template.FormattedIDTemplate\")","                }, ","                {","                    text: \"Name\",","                    dataIndex: \"Name\",","                    flex: 2","                }, ","                \"TimeCriticality\", \"RROEValue\", \"UserBusinessValue\", \"JobSize\", ","                {","                    text: \"WSJF Score\",","                    dataIndex: \"WSJFScore\",","                    editor: null","                }","            ],","            scope: this","        }), this.add(this._myGrid);","    },","    ","    _updateGrid: function(myStore) {","        if (this._myGrid === undefined) {","            this._createGrid(myStore);","        }","        else {","            this._myGrid.reconfigure(myStore);","        }","    },","    ","    _getReleaseFilter: function() {","        var combo = this.down('rallyreleasecombobox');","        return combo.getValue() ?","          [combo.getQueryFromSelected()] : [];","    }","});","","                Ext.define(\"GridExporter\", {","    dateFormat : 'Y-m-d g:i',","","    exportGrid: function(grid) {","        if (Ext.isIE) {","            this._ieToExcel(grid);","        } else {","            var data = this._getCSV(grid);","            window.location = 'data:text/csv;charset=utf8,' + encodeURIComponent(data);","        }","    },","","    _escapeForCSV: function(string) {","        if (string.match(/,/)) {","            if (!string.match(/\"/)) {","                string = '\"' + string + '\"';","            } else {","                string = string.replace(/,/g, ''); // comma's and quotes-- sorry, just lose the commas","            }","        }","        return string;","    },","","    _getFieldText: function(fieldData) {","        var text;","","        if (fieldData === null || fieldData === undefined) {","            text = '';","            ","        } else if (fieldData._refObjectName && !fieldData.getMonth) {","            text = fieldData._refObjectName;","","        } else if (fieldData instanceof Date) {","            text = Ext.Date.format(fieldData, this.dateFormat);","","        } else if (!fieldData.match) { // not a string or object we recognize...bank it out","            text = '';","","        } else {","            text = fieldData;","        }","","        return text;","    },","","    _getFieldTextAndEscape: function(fieldData) {","        var string  = this._getFieldText(fieldData);","        return this._escapeForCSV(string);","    },","","    _getCSV: function (grid) {","        var cols    = grid.columns;","        var store   = grid.store;","        var data    = '';","","        var that = this;","        Ext.Array.each(cols, function(col, index) {","            if (col.hidden !== true) {","                data += that._getFieldTextAndEscape(col.text) + ',';","            }","        });","        data += \"\\n\";","","        store.each(function(record) {","            var entry       = record.getData();","            Ext.Array.each(cols, function(col, index) {","                if (col.hidden !== true) {","                    var fieldName   = col.dataIndex;","                    var text        = entry[fieldName];","","                    data += that._getFieldTextAndEscape(text) + ',';","                }","            });","            data += \"\\n\";","        });","","        return data;","    },","","    _ieGetGridData : function(grid, sheet) {","        var that            = this;","        var resourceItems   = grid.store.data.items;","        var cols            = grid.columns;","","        Ext.Array.each(cols, function(col, colIndex) {","            if (col.hidden !== true) {","                console.log('header: ', col.text);","                sheet.cells(1,colIndex + 1).value = col.text;","            }","        });","","        var rowIndex = 2;","        grid.store.each(function(record) {","            var entry   = record.getData();","","            Ext.Array.each(cols, function(col, colIndex) {","                if (col.hidden !== true) {","                    var fieldName   = col.dataIndex;","                    var text        = entry[fieldName];","                    var value       = that._getFieldText(text);","","                    sheet.cells(rowIndex, colIndex+1).value = value;","                }","            });","            rowIndex++;","        });","    },","","    _ieToExcel: function (grid) {","        if (window.ActiveXObject){","            var  xlApp, xlBook;","            try {","                xlApp = new ActiveXObject(\"Excel.Application\"); ","                xlBook = xlApp.Workbooks.Add();","            } catch (e) {","                Ext.Msg.alert('Error', 'For the export to work in IE, you have to enable a security setting called \"Initialize and script ActiveX control not marked as safe\" from Internet Options -> Security -> Custom level...\"');","                return;","            }","","            xlBook.worksheets(\"Sheet1\").activate();","            var XlSheet = xlBook.activeSheet;","            xlApp.visible = true; ","","           this._ieGetGridData(grid, XlSheet);","           XlSheet.columns.autofit(); "]},{"start":{"row":12,"column":4},"end":{"row":233,"column":36},"action":"insert","lines":["componentCls: 'app',","    launch: function() {","        var that = this;","","        // console.log(that.getSettings());","        that.TimeCriticalityField = that.getSetting('TimeCriticalityField');","        that.RROEValueField = that.getSetting('RROEValueField');","        that.UserBusinessValueField = that.getSetting('UserBusinessValueField');","        that.WSJFScoreField = that.getSetting('WSJFScoreField');","        that.JobSizeField = that.getSetting('JobSizeField');","        that.ShowValuesAfterDecimal = that.getSettingsFields('ShowValuesAfterDecimal');","        ","        this._grid = null;","        this._piCombobox = this.add({","            xtype: \"rallyportfolioitemtypecombobox\",","            padding: 5,","            listeners: {","                //ready: this._onPICombobox,","                select: this._onPICombobox,","                scope: this","            }","        });","    },","    ","    _onPICombobox: function() {","        console.log(\"grid: \", this._grid);","        var selectedType = this._piCombobox.getRecord();","        var model = selectedType.get('TypePath');","        ","        if (this._grid !== null) {","            console.log(\"destroying grid\");","            this._grid.destroy();","        }","","        Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({","            models: [ model ],","            listeners: {","                load: function(store) {","                    var records = store.getRootNode().childNodes;","                    console.log(\"loading\");","                    this._calculateScore(records);","                },","                update: function(store, rec, modified, opts) {","                    console.log(\"updating\");","                    this._calculateScore([rec]);","                },","                scope: this","            },","           // autoLoad: true,","            enableHierarchy: true","        }).then({","            success: this._onStoreBuilt,","            scope: this","        });","    },","    ","    _onStoreBuilt: function(store, records) {","        //var records = store.getRootNode().childNodes;","","        console.log(\"loading:\", records);","        //this._calculateScore(records);","  ","        console.log(\"Store Built\");","        var selectedType = this._piCombobox.getRecord();","        var modelNames = selectedType.get('TypePath');","        ","        var context = this.getContext();","        this._grid = this.add({","            xtype: 'rallygridboard',","            context: context,","            modelNames: [ modelNames ],","            toggleState: 'grid',","            stateful: false,","            plugins: [","                {","                    ptype: 'rallygridboardcustomfiltercontrol',","                    filterChildren: false,","                    filterControlConfig: {","                        modelNames: [ modelNames ],","                        stateful: true,","                        stateId: context.getScopedStateId('custom-filter-example')","                    }","                },","                {","                    ptype: 'rallygridboardfieldpicker',","                    headerPosition: 'left',","                    modelNames: [ modelNames ],","                    stateful: true,","                    stateId: context.getScopedStateId('columns-example')","                },","                {","                    ptype: 'rallygridboardactionsmenu',","                    menuItems: [","                        {","                            text: 'Export...',","                            handler: function() {","                                window.location = Rally.ui.grid.GridCsvExport.buildCsvExportUrl(","                                    this.down('rallygridboard').getGridOrBoard());","                            },","                            scope: this","                        }","                    ],","                    buttonConfig: {","                        iconCls: 'icon-export'","                    }","                }","            ],","            gridConfig: {","                store: store,","                columnCfgs: [","                    'Name',","                    'TimeCriticality', 'RROEValue', 'UserBusinessValue', 'JobSize', ","                    this.getSetting(\"useExecutiveMandateField\")===true ? this.getSetting(\"ExecutiveMandateField\") : null,","                    {","                        text: \"WSJF Score\",","                        dataIndex: \"WSJFScore\",","                        editor: null","                    }","                ]","            },","            height: this.getHeight()","        });","    },","    ","    _calculateScore: function(records)  {","        var that = this;","        console.log(\"Calculate Score\");","        Ext.Array.each(records, function(feature) {","            console.log(\"Calc Score Feature: \", feature.data);","            var jobSize = feature.data.JobSize;","            var execMandate = that.getSetting(\"useExecutiveMandateField\")===true ? feature.data[that.getSetting(\"ExecutiveMandateField\")] : 1;","            execMandate = _.isUndefined(execMandate) || _.isNull(execMandate) || execMandate === 0 ? 1 : execMandate;","            ","            var timeValue = feature.data[that.TimeCriticalityField];","            var OERR      = feature.data[that.RROEValueField];","            var userValue = feature.data[that.UserBusinessValueField];","            var oldScore  = feature.data[that.WSJFScoreField];","            var isChecked = that.getSetting(\"ShowValuesAfterDecimal\");","            ","            if (jobSize > 0) { // jobSize is the denominator so make sure it's not 0","                var score;","    ","                if( !isChecked ) {","                    score = ( ((userValue + timeValue + OERR ) * execMandate) / jobSize);","                    score = Math.round(score);","                }","                else {","                    score = Math.floor(((userValue + timeValue + OERR ) * execMandate / jobSize) * 100)/100;","                }","","                if (oldScore !== score) { // only update if score changed","                    feature.set('WSJFScore', score); // set score value in db","                }","            }","        });","    },","    ","    getSettingsFields: function() {","        var values = [","            {","                name: 'ShowValuesAfterDecimal',","                xtype: 'rallycheckboxfield',","                label : \"Show Values After the Decimal\",","                labelWidth: 200","            },","            {","                name: 'useExecutiveMandateField',","                xtype: 'rallycheckboxfield',","                label : \"Use Custom Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'ExecutiveMandateField',","                xtype: 'rallytextfield',","                label : \"Executive Mandate Field\",","                labelWidth: 200","            },","            {","                name: 'TimeCriticalityField',","                xtype: 'rallytextfield',","                label : \"Time Criticality Field\",","                labelWidth: 200","            },","            {","                name: 'RROEValueField',","                xtype: 'rallytextfield',","                label : \"RROEValue Field\",","                labelWidth: 200","            },","            {","                name: 'UserBusinessValueField',","                xtype: 'rallytextfield',","                label : \"User Business Value Field\",","                labelWidth: 200","            },","            {","                name: 'WSJFScoreField',","                xtype: 'rallytextfield',","                label : \"WSJFScore Field\",","                labelWidth: 200","            },","            {","                name: 'JobSizeField',","                xtype: 'rallytextfield',","                label : \"Job Size Field\",","                labelWidth: 200","            }","        ];","","        return values;","    },","","    config: {","        defaultSettings : {","            ShowValuesAfterDecimal: false,","            useExecutiveMandateField : false,","            ExecutiveMandateField : 'c_ExecutiveMandate',","            TimeCriticalityField : 'TimeCriticality',","            RROEValueField : 'RROEValue',","            UserBusinessValueField : 'UserBusinessValue',","            WSJFScoreField : 'WSJFScore',","            JobSizeField : 'JobSize'"]},{"start":{"row":236,"column":3},"end":{"row":237,"column":0},"action":"insert","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":258,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1433961719000,"hash":"c40af728a7e668be9ae8b8e40357f88cf22d576d"}